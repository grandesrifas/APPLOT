<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOTERY</title>
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest"
          href="data:application/json;base64,eyJuYW1lIjoiU2lzdGVtYSBkZSBMb3RlcmlhIiwic2hvcnRfbmFtZSI6IkxvdGVyaWEiLCJzdGFydF91cmwiOiIvIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiI2ZmZmZmZiIsInRoZW1lX2NvbG9yIjoiIzAwN2JmZiJ9">
    <title>Sistema de Loter칤a</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --main-button-color: #ffb347;
            --button-hover-color: #ffa533;
        }

        body {
            min-height: 100vh;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #fff;
            display: flex;
            justify-content: center;
            /* horizontal center */
            align-items: center;
        }

        #loginPage {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .container {
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            background-color: #ffffff;
            margin: 0 auto;
            max-width: 800px;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .input-group {
            width: 100%;
        }

        .input-group select,
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
            background-color: #ffffff;
            box-sizing: border-box;
        }

        button {
            width: 100%;
            padding: 12px 20px;
            background: linear-gradient(135deg, #8e9eab 0%, #6c7b7f 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            margin-bottom: 10px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(142, 158, 171, 0.4);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(142, 158, 171, 0.5);
            background: linear-gradient(135deg, #a8b8c2 0%, #8e9eab 100%);
        }

        button:active {
            transform: translateY(0px);
            box-shadow: 0 2px 10px rgba(142, 158, 171, 0.3);
        }

        /* Todos los botones espec칤ficos ahora en gris metalizado */
        button[onclick*="generateTicket"] {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.4);
        }

        button[onclick*="generateTicket"]:hover {
            background: linear-gradient(135deg, #b4c6c7 0%, #95a5a6 100%);
            box-shadow: 0 6px 20px rgba(149, 165, 166, 0.5);
        }

        button[onclick*="showSalesPage"] {
            background: linear-gradient(135deg, #90a4ae 0%, #78909c 100%);
            box-shadow: 0 4px 15px rgba(144, 164, 174, 0.4);
        }

        button[onclick*="showSalesPage"]:hover {
            background: linear-gradient(135deg, #a8bcc8 0%, #90a4ae 100%);
            box-shadow: 0 6px 20px rgba(144, 164, 174, 0.5);
        }

        button[onclick*="showNumberSalesPage"] {
            background: linear-gradient(135deg, #8d9db6 0%, #667292 100%);
            box-shadow: 0 4px 15px rgba(141, 157, 182, 0.4);
        }

        button[onclick*="showNumberSalesPage"]:hover {
            background: linear-gradient(135deg, #a5b7d1 0%, #8d9db6 100%);
            box-shadow: 0 6px 20px rgba(141, 157, 182, 0.5);
        }

        button[onclick*="showVerifyWinnersPage"] {
            background: linear-gradient(135deg, #9e9e9e 0%, #757575 100%);
            box-shadow: 0 4px 15px rgba(158, 158, 158, 0.4);
        }

        button[onclick*="showVerifyWinnersPage"]:hover {
            background: linear-gradient(135deg, #bdbdbd 0%, #9e9e9e 100%);
            box-shadow: 0 6px 20px rgba(158, 158, 158, 0.5);
        }

        /* Botones de eliminar - gris m치s oscuro */
        .ticket-actions button:last-child,
        button[onclick*="deleteTicket"],
        button[onclick*="deleteSalesByDate"] {
            background: linear-gradient(135deg, #616161 0%, #424242 100%) !important;
            box-shadow: 0 4px 15px rgba(97, 97, 97, 0.4) !important;
        }

        .ticket-actions button:last-child:hover,
        button[onclick*="deleteTicket"]:hover,
        button[onclick*="deleteSalesByDate"]:hover {
            background: linear-gradient(135deg, #757575 0%, #616161 100%) !important;
            box-shadow: 0 6px 20px rgba(97, 97, 97, 0.5) !important;
        }

        /* Botones peque침os de acciones en tickets */
        .ticket-actions button {
            padding: 8px 12px;
            font-size: 12px;
            margin: 2px;
            border-radius: 8px;
            background: linear-gradient(135deg, #8e9eab 0%, #6c7b7f 100%);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(142, 158, 171, 0.4);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        /* Botones de la vista previa del ticket - m치s compactos */
        /* Botones de la vista previa del ticket - cuadr칤cula 2x2 - M츼S ESPEC칈FICO */
        #ticketPreview .ticket-actions {
            display: grid !important;
            grid-template-columns: 1fr 1fr !important;
            grid-template-rows: 1fr 1fr !important;
            gap: 10px !important;
            margin-top: 15px !important;
            flex-direction: unset !important;
        }

        #ticketPreview .ticket-actions button {
            padding: 12px 8px !important;
            font-size: 12px !important;
            font-weight: 600 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.3px !important;
            white-space: nowrap !important;
            min-height: 45px !important;
            margin: 0 !important;
            width: 100% !important;
            box-sizing: border-box !important;
        }

        /* Forzar cuadr칤cula en vista previa - PRIORIDAD M츼XIMA */
        div#ticketPreview div.ticket-actions {
            display: grid !important;
            grid-template-columns: repeat(2, 1fr) !important;
            grid-template-rows: repeat(2, 1fr) !important;
            gap: 12px !important;
            flex-direction: unset !important;
            align-items: stretch !important;
        }

        div#ticketPreview div.ticket-actions button {
            margin: 0 !important;
            flex: none !important;
            width: 100% !important;
            padding: 14px 8px !important;
            min-height: 48px !important;
        }

        .ticket-actions button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(142, 158, 171, 0.5);
            background: linear-gradient(135deg, #a8b8c2 0%, #8e9eab 100%);
        }

        /* Bot칩n de compartir ticket */
        .screenshot-button {
            background: linear-gradient(135deg, #90a4ae 0%, #78909c 100%) !important;
            color: white !important;
            border: none !important;
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 4px 20px rgba(144, 164, 174, 0.4);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .screenshot-button:hover {
            background: linear-gradient(135deg, #a8bcc8 0%, #90a4ae 100%) !important;
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(144, 164, 174, 0.5);
        }

        .screenshot-button:disabled {
            background: linear-gradient(135deg, #ccc 0%, #999 100%) !important;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .capturing {
            background: linear-gradient(135deg, #b0bec5 0%, #90a4ae 100%) !important;
        }

        /* Bot칩n de configurar porcentaje */
        .percentage-config-button {
            background: linear-gradient(135deg, #8d9db6 0%, #667292 100%) !important;
            color: white !important;
            margin-top: 15px;
            padding: 12px 20px;
            font-size: 14px;
            border-radius: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(141, 157, 182, 0.4);
            transition: all 0.3s ease;
        }

        .percentage-config-button:hover {
            background: linear-gradient(135deg, #a5b7d1 0%, #8d9db6 100%) !important;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(141, 157, 182, 0.5);
        }

        /* Botones en modal */
        .modal-content button {
            border-radius: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 12px rgba(142, 158, 171, 0.3);
            background: linear-gradient(135deg, #8e9eab 0%, #6c7b7f 100%);
        }

        .modal-content button:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 16px rgba(142, 158, 171, 0.4);
            background: linear-gradient(135deg, #a8b8c2 0%, #8e9eab 100%);
        }

        /* Botones de volver */
        button[onclick*="showMainPage"] {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.4);
        }

        button[onclick*="showMainPage"]:hover {
            background: linear-gradient(135deg, #868e96 0%, #6c757d 100%);
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.5);
        }

        .ticket-content {
            padding: 15px;
        }

        .ticket-header {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 8px;
        }

        .ticket-info {
            font-size: 1.2em;
        }

        .ticket-numbers p {
            font-family: monospace;
            font-size: 2.0em !important;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }

        .ticket-total {
            font-size: 1.8em;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
        }

        #qrcode {
            margin: 4px auto;
            text-align: center;
            padding: 4px;
            background: white;
        }

        .total {
            font-size: 1.3em;
            font-weight: bold;
            margin: 15px 0;
            text-align: center;
        }

        .scanner-container {
            margin-top: 20px;
            display: none;
        }

        .ticket-item {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }

        .ticket-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* Nuevos estilos para los botones de editar y eliminar */
        .ticket-actions button {
            padding: 5px 10px;
            /* Tama침o m치s peque침o */
            font-size: 12px;
            /* Texto m치s peque침o */
            margin: 2px;
            /* Espaciado entre botones */
            border-radius: 4px;
            /* Bordes redondeados */
            background-color: var(--main-button-color);
            /* Color principal */
            color: white;
            /* Texto en blanco */
            border: none;
            /* Sin borde */
            cursor: pointer;
            /* Cursor de mano */
            transition: background-color 0.3s;
            /* Transici칩n suave */
        }

        .ticket-actions button:hover {
            background-color: var(--button-hover-color);
            /* Color al pasar el mouse */
        }

        /* Estilos espec칤ficos para el bot칩n de eliminar */
        .ticket-actions button:last-child {
            background-color: #ff4d4d;
            /* Color rojo para el bot칩n de eliminar */
        }

        .ticket-actions button:last-child:hover {
            background-color: #cc0000;
            /* Color rojo oscuro al pasar el mouse */
        }

        /* Estilos para la tabla */
        #numbersList table {
            width: 100%;
            border-collapse: collapse;
            /* Elimina el espacio entre celdas */
        }

        /* Estilos para el logo con imagen */
        .ticket-logo {
            width: 120px;
            height: 80px;
            margin: 5px auto 2px auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ticket-logo img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        #numbersList th,
        #numbersList td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            /* L칤nea divisoria entre filas */
        }

        #numbersList th {
            background-color: #f2f2f2;
            /* Fondo gris claro para el encabezado */
        }

        /* Ajustar el ancho de las columnas */
        #numbersList td:nth-child(1) {
            width: 30%;
        }

        /* Columna del n칰mero */
        #numbersList td:nth-child(2) {
            width: 20%;
        }

        /* Columna de los tiempos */
        #numbersList td:nth-child(3) {
            width: 20%;
        }

        /* Columna del subtotal */
        #numbersList td:nth-child(4) {
            width: 30%;
        }

        /* Columna de los botones */
        /* Estilos para la cuadr칤cula de tiempos vendidos */
        /* Estilos para la cuadr칤cula de tiempos vendidos (mantener en 5 columnas) */
        #numberSalesGrid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            /* 5 columnas para tiempos vendidos */
            gap: 1px;
            /* Espacio entre los n칰meros */
            border: 1px solid #ccc;
            /* Borde exterior de la cuadr칤cula */
            background-color: #ccc;
            /* Color de fondo para las l칤neas de la cuadr칤cula */
        }

        /* Estilos para la cuadr칤cula de billetes vendidos (cambiar a 4 columnas) */
        #billetesSalesGrid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            /* 4 columnas para billetes vendidos */
            gap: 1px;
            /* Espacio entre los n칰meros */
            border: 1px solid #ccc;
            /* Borde exterior de la cuadr칤cula */
            background-color: #ccc;
            /* Color de fondo para las l칤neas de la cuadr칤cula */
        }

        /* Estilos comunes para los items */
        .number-item,
        .billete-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            /* Reducir el padding */
            background-color: #ffffff;
            /* Fondo blanco para cada celda */
            border: 1px solid #ccc;
            /* Borde para cada celda */
        }

        .number-item span,
        .billete-item span {
            font-size: 0.9em;
            /* Reducir el tama침o de la fuente */
            font-weight: bold;
        }

        .number-item span:first-child,
        .billete-item span:first-child {
            color: #000000;
            /* Color negro para el n칰mero */
        }

        .number-item span:last-child,
        .billete-item span:last-child {
            color: red;
            /* Color rojo para los tiempos vendidos */
        }

        .number-item.highlight,
        .billete-item.highlight {
            background-color: #e0f7ff;
            /* Azul claro */
        }

        /* Estilos para las pesta침as */
        .tabs {
            display: flex;
            justify-content: center;
            /* Centrar los botones */
            border-bottom: 1px solid #ccc;
            margin-bottom: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 5px;
            /* Agregar padding al contenedor */
            gap: 10px;
            /* Espacio entre botones */
        }

        .tab-button {
            flex: none;
            /* Cambiar de flex: 1 a flex: none */
            width: auto;
            /* Ancho autom치tico */
            max-width: 180px;
            /* Ancho m치ximo reducido */
            padding: 12px 25px;
            /* Reducir padding */
            margin: 5px;
            /* Agregar margen para separaci칩n */
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            color: #6c757d;
            border: none;
            border-radius: 6px;
            /* Agregar bordes redondeados */
            cursor: pointer;
            font-size: 16px;
            /* Reducir tama침o de fuente */
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            transition: all 0.3s ease;
        }


        .tab-button:hover {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #495057;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #8e9eab 0%, #6c7b7f 100%);
            color: white;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            /* Cambiar la sombra */
            border: 2px solid #495057;
            /* Agregar borde en lugar de border-bottom */
        }

        .tab-button.active:hover {
            background: linear-gradient(135deg, #a8b8c2 0%, #8e9eab 100%);
            color: white;
        }

        /* Contenedor de pesta침as con mejor estilo */
        .tab-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .info-text {
            margin-bottom: 10px;
            font-style: italic;
        }

        .ticket-item p {
            margin: 5px 0;
            /* Espaciado entre los p치rrafos */
            font-size: 14px;
            /* Tama침o de fuente */
        }

        .ticket-item strong {
            color: #333;
            /* Color del texto en negrita */
        }

        /* Estilos para el resumen de totales */
        .sales-summary-box {
            background-color: #f8f9fa;
            border: 2px solid #007bff;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .sales-summary-box h3 {
            margin-top: 0;
            color: #007bff;
            font-size: 1.2em;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .stat-item {
            background-color: white;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }

        .stat-value {
            font-size: 1.4em;
            font-weight: bold;
            color: #28a745;
        }

        .stat-label {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
        }

        /* Estilos para el bot칩n de captura */
        .screenshot-button {
            background-color: #25D366 !important;
            color: white !important;
            border: none !important;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background-color 0.3s;
            width: 100%;
        }

        .screenshot-button:hover {
            background-color: #1eb854 !important;
        }

        .screenshot-button:disabled {
            background-color: #ccc !important;
            cursor: not-allowed;
        }

        .capturing {
            background-color: #ff9800 !important;
        }

        .screenshot-container {
            background-color: white;
            padding: 0;
            margin: 0;
        }

        .screenshot-header {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            /* Reducir padding de 15px a 10px */
            text-align: center;
            margin-bottom: 20px;
        }

        .screenshot-header .filters-info-horizontal {
            margin: 0;
            /* Sin margen extra */
        }

        .screenshot-header .filters-info-horizontal div {
            background-color: rgba(255, 255, 255, 0.1);
            /* Fondo sutil para cada item */
            padding: 5px 8px;
            border-radius: 4px;
            font-size: 13px;
            /* Tama침o de fuente m치s peque침o */
        }

        .screenshot-header .filters-info-horizontal strong {
            color: #ffffff;
            margin-right: 5px;
        }

        .screenshot-header .filters-info {
            margin-top: 15px;
            font-size: 1.2em;
            /* Aumentar de 0.9em a 1.2em */
            opacity: 1;
            /* Cambiar de 0.9 a 1 para m치s opacidad */
            font-weight: 600;
            /* Agregar peso de fuente */
            line-height: 1.8;
            /* Mejor espaciado entre l칤neas */
        }

        .screenshot-header .filters-info div {
            margin-bottom: 8px;
            /* Espaciado entre cada l칤nea */
        }

        .screenshot-header .filters-info strong {
            font-size: 1.1em;
            /* Los labels m치s grandes */
            color: #ffffff;
            /* Asegurar que sean blancos */
        }

        /* Estilos para porcentajes de vendedor */
        .percentage-breakdown {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .percentage-item {
            background-color: white;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            text-align: center;
        }

        .percentage-item.seller {
            border-color: #28a745;
            background-color: #f8fff9;
        }

        .percentage-item.admin {
            border-color: #007bff;
            background-color: #f8f9ff;
        }

        .percentage-value {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .percentage-label {
            font-size: 0.85em;
            color: #6c757d;
        }

        .percentage-config-button {
            background-color: #17a2b8 !important;
            color: white !important;
            margin-top: 10px;
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 4px;
        }

        .percentage-config-button:hover {
            background-color: #138496 !important;
        }

        /* Modal para configurar porcentaje */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            border-radius: 8px;
            width: 80%;
            max-width: 400px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-modal:hover {
            color: black;
        }

        /* AGREGAR ESTA SECCI칍N COMPLETA */
        .ticket-preview {
            background: white;
            padding: 20px;
            max-width: 400px;
            margin: 20px auto;
            border: 1px solid #ccc;
            border-radius: 8px;
            display: none;
        }

        /* Mejorar inputs y selects */
        .input-group select,
        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            background-color: #ffffff;
            box-sizing: border-box;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .input-group select:focus,
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        /* Estilos para notificaciones personalizadas */
        .custom-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 400px;
            min-width: 300px;
            padding: 15px 20px;
            border-radius: 12px;
            color: white;
            font-family: Arial, sans-serif;
            font-weight: 600;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            transform: translateX(450px);
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
        }

        .custom-notification.show {
            transform: translateX(0);
        }

        .custom-notification.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border-left: 4px solid #ffffff;
        }

        .custom-notification.error {
            background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%);
            border-left: 4px solid #ffffff;
        }

        .custom-notification.warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            border-left: 4px solid #ffffff;
            color: #212529;
        }

        .custom-notification.info {
            background: linear-gradient(135deg, #17a2b8 0%, #007bff 100%);
            border-left: 4px solid #ffffff;
        }

        .notification-close {
            position: absolute;
            top: 8px;
            right: 12px;
            background: none;
            border: none;
            color: inherit;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .notification-close:hover {
            opacity: 1;
        }

        /* Modal de confirmaci칩n personalizado */
        .custom-modal {
            display: none;
            position: fixed;
            z-index: 10001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(3px);
        }

        .custom-modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            margin: 15% auto;
            padding: 25px;
            border: none;
            border-radius: 15px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .custom-modal h3 {
            margin-top: 0;
            color: #495057;
            font-size: 1.4em;
            margin-bottom: 15px;
        }

        .custom-modal p {
            color: #6c757d;
            font-size: 1.1em;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 120px;
        }

        .modal-btn.confirm {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
        }

        .modal-btn.confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.5);
        }

        .modal-btn.cancel {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.4);
        }

        .modal-btn.cancel:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.5);
        }

        /* Teclado Num칠rico Personalizado */
        .custom-keyboard {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 2px solid #e5e7eb;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .custom-keyboard.show {
            transform: translateY(0);
        }

        body.keyboard-open {
            padding-bottom: 280px;
        }

        .keyboard-header {
            padding: 8px 15px;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .keyboard-title {
            font-weight: 600;
            color: #374151;
            font-size: 13px;
        }

        .hide-keyboard-btn {
            background: #363434;
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
        }

        .keyboard-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1px;
            background: #e5e7eb;
            padding: 1px;
        }

        .keyboard-btn {
            background: white;
            border: none;
            padding: 15px;
            font-size: 20px;
            font-weight: 600;
            color: #374151;
            /* Agregar color de texto */
            cursor: pointer;
            transition: background-color 0.1s;
            min-height: 50px;
        }

        .keyboard-btn:hover {
            background: #f3f4f6;
            color: #374151;
            /* Mantener color en hover */
        }

        .keyboard-btn:active {
            background: #e5e7eb;
            color: #374151;
            /* Mantener color en active */
        }

        .keyboard-btn.enter {
            background: #02235a;
            color: white;
            /* Blanco para el bot칩n enter */
        }

        .keyboard-btn.enter:hover {
            background: #011541;
            color: white;
            /* Mantener blanco en hover */
        }

        .keyboard-btn.delete {
            background: #434141;
            color: white;
            /* Blanco para el bot칩n delete */
        }

        .keyboard-btn.delete:hover {
            background: #464343;
            color: white;
            /* Mantener blanco en hover */
        }

        /* Estilos para indicar el campo activo */
        .input-group input.keyboard-active {
            border: 2px solid #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }

        /* Estilos para el men칰 hamburguesa */
        .menu-hamburger {
            position: relative;
            top: 0;
            right: 0;
            z-index: 1000;
            background: linear-gradient(135deg, #8e9eab 0%, #6c7b7f 100%);
            border: none;
            border-radius: 8px;
            padding: 8px;
            width: 48px;
            height: 42px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(142, 158, 171, 0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-hamburger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(142, 158, 171, 0.5);
            background: linear-gradient(135deg, #a8b8c2 0%, #8e9eab 100%);
        }

        .hamburger-icon {
            width: 24px;
            height: 18px;
            position: relative;
            transform: rotate(0deg);
            transition: .5s ease-in-out;
            cursor: pointer;
        }

        .hamburger-icon span {
            display: block;
            position: absolute;
            height: 3px;
            width: 100%;
            background: white;
            border-radius: 3px;
            opacity: 1;
            left: 0;
            transform: rotate(0deg);
            transition: .25s ease-in-out;
        }

        .hamburger-icon span:nth-child(1) {
            top: 0px;
        }

        .hamburger-icon span:nth-child(2) {
            top: 7px;
        }

        .hamburger-icon span:nth-child(3) {
            top: 14px;
        }

        .hamburger-icon.open span:nth-child(1) {
            top: 7px;
            transform: rotate(135deg);
        }

        .hamburger-icon.open span:nth-child(2) {
            opacity: 0;
            left: -60px;
        }

        .hamburger-icon.open span:nth-child(3) {
            top: 7px;
            transform: rotate(-135deg);
        }

        .menu-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .menu-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .menu-dropdown::before {
            content: '';
            position: absolute;
            top: -8px;
            right: 20px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid white;
        }

        .menu-item {
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-item:hover {
            background-color: #f8f9fa;
        }

        .menu-item:last-child {
            border-bottom: none;
            border-radius: 0 0 12px 12px;
        }

        .menu-item:first-child {
            border-radius: 12px 12px 0 0;
        }

        .menu-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: 998;
            display: none;
        }

        .menu-overlay.show {
            display: block;
        }

        /* Estilo para el bot칩n de l치piz */
        .pencil-button {
            position: relative;
            background: linear-gradient(135deg, #8e9eab 0%, #6c7b7f 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(142, 158, 171, 0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            margin-left: 15px;
        }

        .pencil-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(142, 158, 171, 0.5);
            background: linear-gradient(135deg, #a8b8c2 0%, #8e9eab 100%);
        }

        /* Modal para seguidillas */
        .seguidilla-modal {
            display: none;
            position: fixed;
            z-index: 10002;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(3px);
        }

        .seguidilla-modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            margin: 10% auto;
            padding: 25px;
            border: none;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        .seguidilla-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 15px;
        }

        .seguidilla-header h3 {
            margin: 0;
            color: #495057;
            font-size: 1.4em;
        }

        .close-seguidilla {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-seguidilla:hover {
            color: #333;
        }

        .seguidilla-form {
            display: grid;
            gap: 15px;
        }

        .seguidilla-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            align-items: end;
        }

        .seguidilla-row .seguidilla-input-group:last-child {
            max-width: 80px;
        }

        .seguidilla-input-group {
            display: flex;
            flex-direction: column;
        }

        .seguidilla-input-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
            font-size: 14px;
        }

        .seguidilla-input-group input {
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            background-color: #ffffff;
            transition: all 0.3s ease;
            text-align: center;
        }

        .seguidilla-input-group input:focus {
            outline: none;
            border-color: #f39c12;
            box-shadow: 0 0 0 3px rgba(243, 156, 18, 0.1);
        }

        .seguidilla-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .seguidilla-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .seguidilla-btn.add {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
        }

        .seguidilla-btn.add:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.5);
        }

        .seguidilla-btn.cancel {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.4);
        }

        .seguidilla-btn.cancel:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.5);
        }

        .seguidilla-info {
            background: #e7f3ff;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #0c5460;
            font-size: 14px;
            line-height: 1.4;
        }
    </style>
</head>

<body>

<div id="loginPage" style="display: none;">
    <h2>Ingrese contrase침a de la app:</h2>
    <div class="input-group">
        <input type="password" id="passwordInput" placeholder="Contrase침a" />
        <button onclick="checkPassword()">Confirmar</button>
    </div>
    <p id="error" style="color:red;"></p>
</div>

<div id="mainPage" class="container" style="display: none;">
    <!-- Contenedor para fecha/hora y men칰 hamburguesa -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <div id="datetime" style="font-size: 1.1em;"></div>
        <!-- Men칰 hamburguesa -->
        <button class="menu-hamburger" onclick="toggleMenu()">
            <div class="hamburger-icon" id="hamburgerIcon">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
    </div>

    <!-- Campo para el nombre del cliente -->
    <div class="input-group" style="margin-bottom: 15px;">
        <input type="text" id="customerName" placeholder="Nombre del Cliente">
    </div>
    <!-- Selecci칩n de loter칤a y hora en una fila -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
        <div class="input-group">
            <select id="lotteryType" onchange="updateDrawTimes()">
                <option value="">Elegir loteria</option>
                <option value="PANAMA">LOTERIA PANAMA</option>
                <option value="NICA">NICA</option>
                <option value="MONAZO">MONAZO</option>
                <option value="LAPRIMERA">LAPRIMERA</option>
                <option value="TICA">TICA</option>
                <option value="NEWYORK">NEW YORK</option>
                <option value="HONDURAS">HONDURAS</option>
            </select>
        </div>
        <div class="input-group">
            <select id="drawTimeSelect" disabled>
                <option value="">Hora de sorteo</option>
            </select>
        </div>
    </div>

    <!-- N칰mero y pedazos en una fila -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
        <div class="input-group">
            <input type="number" id="number" placeholder="NUMERO">
        </div>
        <div class="input-group">
            <input type="number" id="pieces" placeholder="TIEMPOS">
        </div>
    </div>


    <!-- Entrada R치pida -->
    <div style="margin-top: 15px; margin-bottom: 15px;">
        <label for="quickInput" style="display: block; margin-bottom: 5px; font-weight: bold;">Entrada
            R치pida:</label>
        <div style="display: flex; gap: 10px;">
            <div class="input-group" style="flex-grow: 1;">
                <input type="text" id="quickInput" placeholder="Ej: 39,9 o 45,2 o 12,5">
            </div>
            <button onclick="processQuickInput()" style="width: auto; padding: 12px 20px;">
                Procesar
            </button>
        </div>
    </div>

    <!-- Lista de n칰meros -->
    <div id="numbersList">
        <table style="width: 100%">
            <thead>
            <tr>
                <th>NUMERO</th>
                <th>CANT</th>
                <th>SUB TOTAL</th>
                <th></th>
            </tr>
            </thead>
            <tbody id="numbersTableBody"></tbody>
        </table>
    </div>

    <div id="totalValue" class="total">VALOR DE TICKET: 0.00$</div>

    <div style="display: flex; align-items: center; gap: 10px;">
        <button onclick="generateTicket()" style="flex: 1;">GENERAR TICKET</button>
        <button class="pencil-button" onclick="openSeguidillaModal()" title="Entrada R치pida - Seguidillas">
            九勇
        </button>
    </div>


    <!-- Men칰 desplegable -->
    <div class="menu-dropdown" id="menuDropdown">
        <div class="menu-item" onclick="showSalesPage()">
            <span class="menu-icon">游눯</span>
            <span>Ver Ventas</span>
        </div>
        <div class="menu-item" onclick="showNumberSalesPage()">
            <span class="menu-icon">游늵</span>
            <span>Tiempos Vendidos</span>
        </div>
        <div class="menu-item" onclick="showVerifyWinnersPage()">
            <span class="menu-icon">游끥</span>
            <span>Verificar Ganadores</span>
        </div>
        <div class="menu-item" onclick="showConfigPage()">
            <span class="menu-icon">丘뙖잺</span>
            <span>Configurar L칤mites</span>
        </div>
        <div class="menu-item" onclick="openPercentageModal()">
            <span class="menu-icon">游녻</span>
            <span>Configurar Usuario</span>
        </div>
    </div>

    <!-- Overlay para cerrar men칰 -->
    <div class="menu-overlay" id="menuOverlay" onclick="closeMenu()"></div>

    <!-- Vista previa del ticket -->
    <div id="ticketPreview" class="ticket-preview">
        <!-- Logo con imagen URL de Imgur -->
        <div class="ticket-logo">
            <img src="data:image/png;base64,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"
                 alt="Los Tios Logo">
        </div>

        <div class="ticket-header">APM11</div>
        <div id="ticketContent" class="ticket-content"></div>
        <div id="qrcode"></div>
        <div class="ticket-actions">
            <button onclick="compartirTicket()">COMPARTIR TICKET</button>
            <button onclick="closeTicket()">CERRAR</button>
        </div>
    </div>
</div>

<!-- P치gina de Ventas -->
<div id="salesPage" class="container" style="display: none;">
    <h2>Registro de Ventas</h2>
    <div style="margin-bottom: 20px;">
        <h3>Buscar tickets</h3>
    </div>
    <div class="input-group">
        <input type="text" id="searchInput" placeholder="Buscar por ID de ticket">
        <button onclick="searchTickets()">Buscar</button>
        <button onclick="toggleScanner()">ESCANEAR QR</button>
    </div>
    <div class="scanner-container" id="scannerContainer">
        <div id="reader"></div>
    </div>
    <button onclick="showMainPage()">Volver</button>

    <div class="sales-summary">
        <h3>Resumen de Ventas</h3>
        <div class="date-selector">
            <input type="date" id="salesDate" onchange="showSalesByDate(this.value)">
            <button onclick="showTodaySales()">Ver Hoy</button>
            <button onclick="deleteSalesByDate()" style="background-color: #ff4d4d; color: white;">
                Borrar D칤a
            </button>
        </div>
        <button onclick="borrarTodasVentas()" style="background-color: #dc3545; color: white; margin-top: 10px;">
            Borrar TODAS las Ventas
        </button>

        <div class="sales-stats">
            <p><strong>Fecha:</strong> <span id="currentSalesDate"></span></p>
            <p><strong>Total Tickets:</strong> <span id="totalTickets">0</span></p>
            <p><strong>Total Ventas:</strong> $<span id="totalSales">0.00</span></p>
        </div>
    </div>

    <div id="ticketsList" class="ticket-list"></div>
</div>

<!-- P치gina de Tiempos y Billetes Vendidos -->
<div id="numberSalesPage" class="container" style="display: none;">
    <h2>TIEMPOS Y BILLETES VENDIDOS</h2>

    <!-- Pesta침as para alternar entre tiempos y billetes -->
    <div class="tabs">
        <button id="tiemposTab" class="tab-button active" onclick="switchTab('tiempos')">CHANCES</button>
        <button id="billetesTab" class="tab-button" onclick="switchTab('billetes')">BILLETES</button>
    </div>

    <!-- Filtros -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
        <div class="input-group">
            <select id="filterLotteryType" onchange="updateFilterDrawTimes()">
                <option value="">Todas las Loter칤as</option>
                <option value="PANAMA">LOTERIA PANAMA</option>
                <option value="NICA">NICA</option>
                <option value="MONAZO">MONAZO</option>
                <option value="LAPRIMERA">LAPRIMERA</option>
                <option value="TICA">TICA</option>
                <option value="NEWYORK">NEW YORK</option>
                <option value="HONDURAS">HONDURAS</option>
            </select>
        </div>
        <div class="input-group">
            <select id="filterDrawTimeSelect" disabled>
                <option value="">Todas las Horas</option>
            </select>
        </div>
    </div>

    <!-- Filtro por fecha -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
        <div class="input-group">
            <input type="date" id="salesFilterDate" onchange="applyFilters()">
        </div>
        <button onclick="applyFilters()">Filtrar</button>
    </div>

    <!-- Resumen de totales -->
    <div id="salesSummaryBox" class="sales-summary-box" style="display: none;">
        <h3>Resumen de Ventas</h3>
        <div class="summary-stats">
            <div class="stat-item">
                <div class="stat-value" id="totalTiempos">0</div>
                <div class="stat-label">Cantidad</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalColones">$0</div>
                <div class="stat-label">Valor</div>
            </div>
        </div>
    </div>

    <!-- Bot칩n de captura de pantalla -->
    <button id="screenshotButton" class="screenshot-button" onclick="captureAndShareScreen()">
        Compartir por WhatsApp
    </button>

    <!-- Contenedor para tiempos vendidos (2 cifras) -->
    <div id="tiemposContainer">
        <div id="numberSalesGrid">
            <!-- Aqu칤 se llenar치n los n칰meros del 00 al 99 -->
        </div>
        <button onclick="shareReport('tiempos')" style="margin-top: 20px;">Compartir CSV</button>
    </div>

    <!-- Contenedor para billetes vendidos (4 cifras) -->
    <div id="billetesContainer" style="display: none;">
        <div id="billetesSalesGrid">
            <!-- Aqu칤 se llenar치n los billetes vendidos de 4 cifras -->
        </div>
        <button onclick="shareReport('billetes')" style="margin-top: 20px;">Compartir CSV</button>
    </div>

    <!-- Bot칩n para volver a la p치gina principal -->
    <button onclick="showMainPage()" style="margin-top: 20px;">Volver</button>
</div>

<!-- P치gina de verificar ganadores -->
<div id="verifyWinnersPage" class="container" style="display: none;">
    <h2>Verificar Tickets Ganadores</h2>

    <!-- Filtros -->
    <div style="margin-bottom: 15px;">
        <h3>Filtrar Tickets</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
            <div class="input-group">
                <input type="date" id="winnersFilterDate">
            </div>
            <div class="input-group">
                <select id="filterLottery">
                    <option value="">Todas las Loter칤as</option>
                    <option value="PANAMA">LOTERIA PANAMA</option>
                    <option value="NICA">NICA</option>
                    <option value="MONAZO">MONAZO</option>
                    <option value="LAPRIMERA">LAPRIMERA</option>
                    <option value="TICA">TICA</option>
                    <option value="NEWYORK">NEW YORK</option>
                    <option value="HONDURAS">HONDURAS</option>
                </select>
            </div>
            <div class="input-group">
                <select id="filterDrawTime" disabled>
                    <option value="">Todas las Horas</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Campos para ingresar los n칰meros ganadores -->
    <div style="margin-bottom: 15px;">
        <h3>N칰meros Ganadores</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
            <div class="input-group">
                <input type="number" id="firstPrize" placeholder="1er Premio" inputmode="numeric" pattern="[0-9]*">
            </div>
            <div class="input-group">
                <input type="number" id="secondPrize" placeholder="2do Premio" inputmode="numeric" pattern="[0-9]*">
            </div>
            <div class="input-group">
                <input type="number" id="thirdPrize" placeholder="3er Premio" inputmode="numeric" pattern="[0-9]*">
            </div>
        </div>
        <button onclick="checkWinningTickets()" style="margin-top: 15px;">Verificar Ganadores</button>
    </div>


    <!-- Resultados de los tickets ganadores -->
    <div id="winningTicketsResult" style="margin-top: 20px;"></div>

    <!-- Bot칩n para volver a la p치gina principal -->
    <button onclick="showMainPage()" style="margin-top: 20px;">Volver a Ventas</button>
</div>

<!-- P치gina de configuraci칩n de l칤mites -->
<div id="configPage" class="container" style="display: none;">
    <h2>Configuraci칩n de L칤mites de Venta</h2>

    <!-- Pesta침as para alternar entre chances y billetes -->
    <div class="tabs">
        <button id="chancesLimitTab" class="tab-button active" onclick="switchLimitTab('chances')">
            Chances
        </button>
        <button id="billetesLimitTab" class="tab-button" onclick="switchLimitTab('billetes')">
            Billetes
        </button>
    </div>

    <!-- Configuraci칩n de l칤mites para chances (2 cifras) -->
    <div id="chancesLimitContainer">
        <div style="margin-bottom: 15px;">
            <h3>Config L칤mites chance</h3>

            <!-- Selector de loter칤a y hora -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                <div class="input-group">
                    <select id="limitLotteryType" onchange="updateLimitDrawTimes()">
                        <option value="">Elegir loteria</option>
                        <option value="PANAMA">LOTERIA PANAMA</option>
                        <option value="NICA">NICA</option>
                        <option value="MONAZO">MONAZO</option>
                        <option value="LAPRIMERA">LAPRIMERA</option>
                        <option value="TICA">TICA</option>
                        <option value="NEWYORK">NEW YORK</option>
                        <option value="HONDURAS">HONDURAS</option>
                    </select>
                </div>
                <div class="input-group">
                    <select id="limitDrawTimeSelect" disabled>
                        <option value="">Hora de sorteo</option>
                    </select>
                </div>
            </div>

            <!-- Configuraci칩n general para todos los n칰meros -->
            <div style="margin-bottom: 15px;">
                <h4>L칤mite Global para Todos los N칰meros</h4>
                <div class="input-group">
                    <input type="number" id="globalChancesLimit"
                           placeholder="L칤mite global para todos los n칰meros (ej: 100)" min="1">
                </div>
                <button onclick="setGlobalLimit('chances')" style="margin-top: 10px;">Aplicar L칤mite Global</button>
            </div>

            <!-- Configuraci칩n individual -->
            <div style="margin-bottom: 15px;">
                <h4>L칤mite Individual por N칰mero</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="input-group">
                        <input type="number" id="chanceNumber" placeholder="N칰mero (00-99)" min="0" max="99">
                    </div>
                    <div class="input-group">
                        <input type="number" id="chanceLimit" placeholder="L칤mite de tiempos" min="0">
                    </div>
                </div>
                <button onclick="setIndividualLimit('chances')" style="margin-top: 10px;">Aplicar L칤mite
                    Individual</button>
            </div>

            <!-- Visualizaci칩n de l칤mites actuales -->
            <div style="margin-top: 20px;">
                <h4>L칤mites Actuales</h4>
                <div id="currentChancesLimits"
                     style="max-height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;">
                    <!-- Aqu칤 se mostrar치n los l칤mites actuales -->
                </div>
            </div>
        </div>
    </div>

    <!-- Configuraci칩n de l칤mites para billetes (4 cifras) -->
    <div id="billetesLimitContainer" style="display: none;">
        <div style="margin-bottom: 15px;">
            <h3>Config L칤mites Billetes</h3>

            <!-- Selector de loter칤a y hora -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                <div class="input-group">
                    <select id="limitBilleteLotteryType" onchange="updateLimitBilleteDrawTimes()">
                        <option value="">Elegir loteria</option>
                        <option value="PANAMA">LOTERIA PANAMA</option>
                        <option value="NICA">NICA</option>
                        <option value="MONAZO">MONAZO</option>
                        <option value="LAPRIMERA">LAPRIMERA</option>
                        <option value="TICA">TICA</option>
                        <option value="NEWYORK">NEW YORK</option>
                        <option value="HONDURAS">HONDURAS</option>
                    </select>
                </div>
                <div class="input-group">
                    <select id="limitBilleteDrawTimeSelect" disabled>
                        <option value="">Hora de sorteo</option>
                    </select>
                </div>
            </div>

            <!-- Configuraci칩n general para todos los billetes -->
            <div style="margin-bottom: 15px;">
                <h4>L칤mite Global para Todos los Billetes</h4>
                <p class="info-text">Este l칤mite se aplicar치 a cada n칰mero individualmente si no tiene un l칤mite
                    espec칤fico.</p>
                <div class="input-group">
                    <input type="number" id="globalBilletesLimit"
                           placeholder="L칤mite global para todos los billetes (ej: 10)" min="1">
                </div>
                <button onclick="setGlobalLimit('billetes')" style="margin-top: 10px;">Aplicar L칤mite
                    Global</button>
            </div>

            <!-- Configuraci칩n individual para billetes -->
            <div style="margin-bottom: 15px;">
                <h4>L칤mite Individual por Billete</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="input-group">
                        <input type="number" id="billeteNumber" placeholder="N칰mero (0000-9999)" min="0" max="9999">
                    </div>
                    <div class="input-group">
                        <input type="number" id="billeteLimit" placeholder="L칤mite de tiempos" min="0">
                    </div>
                </div>
                <button onclick="setIndividualLimit('billetes')" style="margin-top: 10px;">Aplicar L칤mite
                    Individual</button>
            </div>

            <!-- Visualizaci칩n de l칤mites actuales para billetes -->
            <div style="margin-top: 20px;">
                <h4>L칤mites Actuales</h4>
                <div id="currentBilletesLimits"
                     style="max-height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;">
                    <!-- Aqu칤 se mostrar치n los l칤mites actuales -->
                </div>
            </div>
        </div>
    </div>

    <!-- Bot칩n para guardar configuraci칩n y volver -->
    <button onclick="saveConfigAndReturn()" style="margin-top: 20px;">Guardar Config y Volver</button>
</div>

<!-- Modal para configurar porcentaje del vendedor -->
<div id="percentageModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Configurar Vendedor</h3>
            <span class="close-modal" onclick="closePercentageModal()">&times;</span>
        </div>
        <div style="margin-bottom: 15px;">
            <label for="passwordForPercentage">Contrase침a de administrador:</label>
            <input type="password" id="passwordForPercentage"
                   style="width: 95%; padding: 8px; margin-top: 5px; box-sizing: border-box;">
        </div>
        <div style="margin-bottom: 15px;">
            <label for="sellerNameInput">Nombre del vendedor:</label>
            <input type="text" id="sellerNameInput"
                   style="width: 95%; padding: 8px; margin-top: 5px; box-sizing: border-box;"
                   placeholder="Ej: Juan P칠rez">
        </div>
        <div style="margin-bottom: 15px;">
            <label for="sellerPercentageInput">Porcentaje del vendedor (%):</label>
            <input type="number" id="sellerPercentageInput" min="0" max="100" step="0.1"
                   style="width: 95%; padding: 8px; margin-top: 5px; box-sizing: border-box;" placeholder="Ej: 15">
        </div>
        <div style="display: flex; gap: 10px;">
            <button onclick="saveSellerConfig()" style="flex: 1; background-color: #28a745; color: white;">
                Guardar
            </button>
            <button onclick="closePercentageModal()" style="flex: 1; background-color: #6c757d; color: white;">
                Cancelar
            </button>
        </div>
        <p id="percentageError" style="color: red; margin-top: 10px; display: none;"></p>
    </div>
</div>

<!-- Modal de confirmaci칩n personalizado -->
<div id="customConfirmModal" class="custom-modal">
    <div class="custom-modal-content">
        <h3 id="confirmTitle">Confirmar acci칩n</h3>
        <p id="confirmMessage">쮼st치 seguro de realizar esta acci칩n?</p>
        <div class="modal-buttons">
            <button id="confirmBtn" class="modal-btn confirm">Confirmar</button>
            <button id="cancelBtn" class="modal-btn cancel">Cancelar</button>
        </div>
    </div>
</div>

<!-- Teclado Num칠rico Personalizado -->
<div class="custom-keyboard" id="customKeyboard">
    <div class="keyboard-header">
        <div class="keyboard-title">Ingresa el n칰mero</div>
        <button class="hide-keyboard-btn" onclick="hideKeyboard()">Ocultar</button>
    </div>
    <div class="keyboard-grid">
        <button class="keyboard-btn" onclick="addDigit('1')">1</button>
        <button class="keyboard-btn" onclick="addDigit('2')">2</button>
        <button class="keyboard-btn" onclick="addDigit('3')">3</button>
        <button class="keyboard-btn" onclick="addDigit('4')">4</button>
        <button class="keyboard-btn" onclick="addDigit('5')">5</button>
        <button class="keyboard-btn" onclick="addDigit('6')">6</button>
        <button class="keyboard-btn" onclick="addDigit('7')">7</button>
        <button class="keyboard-btn" onclick="addDigit('8')">8</button>
        <button class="keyboard-btn" onclick="addDigit('9')">9</button>
        <button class="keyboard-btn delete" onclick="deleteDigit()">꺎</button>
        <button class="keyboard-btn" onclick="addDigit('0')">0</button>
        <button class="keyboard-btn enter" onclick="submitNumber()">Enter</button>
    </div>
</div>

<!-- Modal para seguidillas -->
<div id="seguidillaModal" class="seguidilla-modal">
    <div class="seguidilla-modal-content">
        <div class="seguidilla-header">
            <h3>Entrada R치pida - Seguidillas</h3>
            <button class="close-seguidilla" onclick="closeSeguidillaModal()">&times;</button>
        </div>

        <div class="seguidilla-info">
            <strong>游눠 Instrucciones:</strong><br>
            Ingresa el rango de n칰meros (solo 2 cifras) y la cantidad de tiempos para cada n칰mero.<br>
            <strong>Ejemplo:</strong> Del 00 al 50 por 10 tiempos cada uno.
        </div>

        <div class="seguidilla-form">
            <div class="seguidilla-row">
                <div class="seguidilla-input-group">
                    <label for="seguidillaDesde">Desde:</label>
                    <input type="number" id="seguidillaDesde" min="0" max="99" placeholder="00">
                </div>
                <div class="seguidilla-input-group">
                    <label for="seguidillaHasta">Hasta:</label>
                    <input type="number" id="seguidillaHasta" min="0" max="99" placeholder="99">
                </div>
                <div class="seguidilla-input-group">
                    <label for="seguidillaTiempos">Tiempos:</label>
                    <input type="number" id="seguidillaTiempos" min="1" placeholder="1">
                </div>
            </div>

            <div class="seguidilla-buttons">
                <button class="seguidilla-btn add" onclick="addSeguidilla()">Agregar</button>
                <button class="seguidilla-btn cancel" onclick="closeSeguidillaModal()">Cancelar</button>
            </div>
        </div>
    </div>
</div>


</body>


<script>
    const PASSWORD = "12345";
    const AUTH_KEY = "authenticated";

    function checkPassword() {
        const input = document.getElementById("passwordInput").value;
        if (input === PASSWORD) {
            localStorage.setItem(AUTH_KEY, "true");
            showMainPage();
        } else {
            document.getElementById("error").innerText = "Contrase침a incorrecta.";
        }
    }

    // On page load
    document.addEventListener('DOMContentLoaded', () => {
        if (localStorage.getItem(AUTH_KEY) === "true") {
            initApp();
            showMainPage();
        } else {
            showLoginPage();
        }
    });

    function showLoginPage() {
        document.getElementById("loginPage").style.display = "block";

        document.getElementById("passwordInput").addEventListener('input', () => {
            document.getElementById("error").innerText = '';
        });
    }

    // Cargar tickets desde localStorage
    function loadTickets() {
        const savedTickets = localStorage.getItem('lotteryTickets');
        return savedTickets ? JSON.parse(savedTickets) : [];
    }

    // Funci칩n para convertir tickets a CSV
    function convertTicketsToCSV(tickets) {
        const headers = [
            "ID",
            "Fecha",
            "Loteria",
            "Hora de sorteo",
            "Numero",
            "Pedazos",
            "Total",
            "Pagado"
        ];

        // Crear un array para todas las filas
        let allRows = [];

        // Procesar cada ticket por separado
        tickets.forEach(ticket => {
            // Primera fila con todos los datos y el primer n칰mero/pedazo
            const firstRow = [
                ticket.id,
                new Date(ticket.datetime).toLocaleString(),
                ticket.lottery,
                ticket.drawTime || "N/A",
                ticket.numbers[0] ? ticket.numbers[0].number : "",
                ticket.numbers[0] ? ticket.numbers[0].pieces : "",
                ticket.total.toFixed(2),
                ticket.paid ? "Si" : "No"
            ];
            allRows.push(firstRow);

            // Filas adicionales con loter칤a y hora de sorteo repetidas
            for (let i = 1; i < ticket.numbers.length; i++) {
                const numberRow = [
                    "", // ID vac칤o
                    "", // Fecha vac칤a
                    ticket.lottery, // Loter칤a repetida
                    ticket.drawTime || "N/A", // Hora de sorteo repetida
                    ticket.numbers[i].number, // N칰mero
                    ticket.numbers[i].pieces, // Pedazos
                    "", // Total vac칤o
                    "" // Pagado vac칤o
                ];
                allRows.push(numberRow);
            }
        });

        // Unir encabezados y filas en un solo string CSV con comillas para evitar problemas
        const csvContent = [
            headers.join(","), // Encabezados
            ...allRows.map(row => row.map(cell => `"${cell}"`).join(",")) // Filas con comillas
        ].join("\n");

        return csvContent;
    }

    // Funci칩n para descargar el archivo CSV
    function downloadCSV(filename, csvContent) {
        const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
        const link = document.createElement("a");

        if (link.download !== undefined) {
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", filename);
            link.style.visibility = "hidden";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        } else {
            showNotification("Tu navegador no soporta la descarga de archivos CSV.");
        }
    }

    // Funci칩n para exportar las ventas a CSV
    // Funci칩n modificada para exportar tickets con filtro de fecha opcional
    function exportSalesToCSV(dateFilter = null) {
        // Cargar todos los tickets
        const allTickets = loadTickets();

        // Si no hay tickets, mostrar mensaje y salir
        if (allTickets.length === 0) {
            showNotification("No hay ventas para exportar.");
            return;
        }

        let ticketsToExport = allTickets;
        let filename = `ventas_todas_${new Date().toISOString().split("T")[0]}.csv`;

        // Si se proporcion칩 un filtro de fecha, aplicarlo
        if (dateFilter) {
            // Crear objetos Date para el inicio y fin del d칤a seleccionado
            const selectedDate = new Date(dateFilter + 'T00:00:00');
            const endDate = new Date(dateFilter + 'T23:59:59');

            // Filtrar tickets por la fecha seleccionada
            ticketsToExport = allTickets.filter(ticket => {
                const ticketDate = new Date(ticket.datetime);
                return ticketDate >= selectedDate && ticketDate <= endDate;
            });

            // Si no hay tickets para esta fecha, mostrar mensaje y salir
            if (ticketsToExport.length === 0) {
                showNotification("No hay ventas para la fecha seleccionada.");
                return;
            }

            // Nombre de archivo con la fecha seleccionada
            filename = `ventas_${dateFilter}.csv`;
        }

        // Convertir a CSV y descargar
        const csvContent = convertTicketsToCSV(ticketsToExport);
        downloadCSV(filename, csvContent);
    }

    // Funci칩n para exportar las ventas del d칤a seleccionado
    function exportSelectedDaySales() {
        const selectedDate = document.getElementById('salesDate').value;

        if (!selectedDate) {
            showNotification("Por favor, seleccione una fecha primero.");
            return;
        }

        exportSalesToCSV(selectedDate);
    }

    // Variables globales
    let numbers = [];
    let tickets = [];

    function updateDateTime() {
        const now = new Date();
        document.getElementById('datetime').textContent = now.toLocaleString();
    }

    const lotteryTimes = {
        PANAMA: ['3:00 PM'],
        NICA: ['1:00 PM', '4:00 PM', '7:00 PM', '10:00 PM'],
        MONAZO: ['1:55 PM', '5:30 PM', '8:30 PM'],
        LAPRIMERA: ['11:00 AM', '6:00 PM'],
        TICA: ['8:30 PM'],
        NEWYORK: ['2:25 PM', '10:25 PM'],
        HONDURAS: ['11:58 AM', '3:58 PM', '9:58 PM'], // NUEVA L칈NEA
      
    };

    // Funciones auxiliares para manejar el Reventado
    function isReventado(lotteryType) {
        return lotteryType && lotteryType.startsWith('REVENTADO_');
    }

    function getBaseLottery(lotteryType) {
        if (isReventado(lotteryType)) {
            return lotteryType.replace('REVENTADO_', '');
        }
        return lotteryType;
    }

    function getDisplayName(lotteryType) {
        if (isReventado(lotteryType)) {
            const baseLottery = getBaseLottery(lotteryType);
            const baseName = baseLottery === 'LAPRIMERA' ? 'LA PRIMERA' :
                baseLottery === 'NEWYORK' ? 'NEW YORK' :
                    baseLottery === 'HONDURAS' ? 'HONDURAS' : baseLottery; // NUEVA L칈NEA
            return `REVENTADO ${baseName}`;
        }

        switch (lotteryType) {
            case 'LAPRIMERA': return 'LA PRIMERA';
            case 'NEWYORK': return 'NEW YORK';
            case 'HONDURAS': return 'HONDURAS'; // NUEVA L칈NEA
            default: return lotteryType;
        }
    }

    function initApp() {
        updateDateTime();
        setInterval(updateDateTime, 1000);
        loadTickets();

        // Inicializar l칤mites y ventas actuales
        initLimitsAndSales();

        // Inicializar porcentaje del vendedor
        initSellerPercentage();

        // Inicializar teclado num칠rico - AGREGAR ESTA L칈NEA
        initKeyboardEvents();
    }

    function updateDrawTimes() {
        const lotteryType = document.getElementById('lotteryType').value;
        const timeSelect = document.getElementById('drawTimeSelect');
        timeSelect.innerHTML = '<option value="">Seleccione hora de sorteo</option>';

        const baseLottery = getBaseLottery(lotteryType);

        if (lotteryType && baseLottery !== 'PANAMA' && lotteryType !== 'REVENTADO_PANAMA') {
            timeSelect.disabled = false;
            lotteryTimes[lotteryType].forEach(time => {
                timeSelect.innerHTML += `<option value="${time}">${time}</option>`;
            });
        } else if (lotteryType === 'PANAMA' || lotteryType === 'REVENTADO_PANAMA') {
            // Para PANAMA y REVENTADO_PANAMA, establecer 3:00 PM por defecto
            timeSelect.disabled = false;
            timeSelect.innerHTML = '<option value="3:00 PM" selected>3:00 PM</option>';
        } else {
            timeSelect.disabled = true;
        }
    }

    function validateNumber(number) {
        const numStr = number.toString();
        return numStr.length === 2 || numStr.length === 4;
    }

    function calculatePrice(number, pieces, lotteryType, price2Digits = 0.20, price4Digits = 0.25) {
        const numLength = number.toString().length;
        const baseLottery = getBaseLottery(lotteryType);

        // Precios especiales para Reventado
        if (isReventado(lotteryType)) {
            if (numLength === 4) {
                return pieces * 1.00; // CAMBIO: Ahora todos los billetes a $1.00
            } else {
                return pieces * 0.20; // Precio para chances reventado
            }
        }

        // Precio est치ndar para todas las loter칤as
        if (numLength === 4) {
            return pieces * 1.00; // CAMBIO: Todos los billetes de 4 cifras a $1.00
        } else {
            return pieces * 0.20; // Todos los chances de 2 cifras a $0.20
        }
    }



    // Actualizar contador de ventas actuales
    function updateCurrentSales(number, pieces, isAddition) {
        const lotteryType = document.getElementById('lotteryType').value;
        const drawTime = document.getElementById('drawTimeSelect').value || 'default';
        const key = `${lotteryType}_${drawTime}`;

        // Determinar si es un chance (2 cifras) o un billete (4 cifras)
        const type = number.length === 2 ? 'chances' : 'billetes';

        // Inicializar si no existe
        if (!currentSales[type][key]) {
            currentSales[type][key] = {};
        }

        if (!currentSales[type][key][number]) {
            currentSales[type][key][number] = 0;
        }

        // Actualizar el contador (a침adir o restar)
        if (isAddition) {
            currentSales[type][key][number] += pieces;
        } else {
            currentSales[type][key][number] -= pieces;
            if (currentSales[type][key][number] < 0) {
                currentSales[type][key][number] = 0; // Evitar valores negativos
            }
        }
    }

    function updateNumbersList() {
        const tbody = document.getElementById('numbersTableBody');
        tbody.innerHTML = '';

        numbers.forEach((item, index) => {
            const row = tbody.insertRow();
            row.innerHTML = `
                <td>${item.number}</td>
                <td><span id="pieces-${index}">${item.pieces}</span></td>
                <td><span id="subTotal-${index}">$${item.subTotal.toFixed(2)}</span></td>
                <td class="ticket-actions">
                    <button onclick="editPieces(${index})">Edit</button>
                    <button onclick="removeNumber(${index})">X</button>
                </td>
            `;
        });
    }

    function editPieces(index) {
        const oldPieces = numbers[index].pieces;
        const number = numbers[index].number;
        const newPieces = prompt("Ingrese la nueva cantidad de tiempos:", oldPieces);

        if (newPieces !== null && !isNaN(newPieces)) {
            const pieces = parseInt(newPieces, 10);

            if (pieces > 0) {
                // Calcular la diferencia para verificar l칤mites
                const difference = pieces - oldPieces;

                if (difference > 0) {
                    // Solo verificar l칤mites si se est치 aumentando la cantidad
                    if (!checkLimits(number, difference)) {
                        return; // Si no pasa la verificaci칩n de l칤mites, no hacer el cambio
                    }
                }

                // Actualizar el contador de ventas actuales
                updateCurrentSales(number, oldPieces, false); // Restar los tiempos viejos
                updateCurrentSales(number, pieces, true); // A침adir los nuevos tiempos

                // Actualizar los tiempos y el subtotal
                numbers[index].pieces = pieces;
                numbers[index].subTotal = calculatePrice(number, pieces);

                // Actualizar la tabla y el total
                updateNumbersList();
                updateTotal();
            } else {
                showNotification("La cantidad de tiempos debe ser mayor que 0.");
            }
        } else {
            showNotification("Por favor, ingrese un n칰mero v치lido.");
        }
    }

    function removeNumber(index) {
        // Para n칰meros individuales, usar los valores actuales de los selectores
        const currentLottery = document.getElementById('lotteryType').value;
        const currentDrawTime = document.getElementById('drawTimeSelect').value;

        const validationResult = validarHorarioEliminacion(currentLottery, currentDrawTime);

        if (!validationResult.allowed) {
            const message = getEliminationBlockMessage(validationResult);
            showNotification(message, 'warning', 6000);
            return;
        }

        // Obtener el n칰mero y la cantidad de pedazos antes de eliminar
        const number = numbers[index].number;
        const pieces = numbers[index].pieces;

        // Eliminar de la lista
        numbers.splice(index, 1);
        updateNumbersList();
        updateTotal();

        // Actualizar el contador de ventas actuales para este n칰mero
        updateCurrentSales(number, pieces, false);
    }

    function updateTotal() {
        const total = numbers.reduce((sum, item) => sum + item.subTotal, 0);
        document.getElementById('totalValue').textContent = `VALOR DE TICKET: $${total.toFixed(2)}`;
    }

    function showSalesByDate(dateString) {
        const selectedDate = new Date(dateString + 'T00:00:00');
        const endDate = new Date(dateString + 'T23:59:59');

        const tickets = loadTickets();
        const dayTickets = tickets.filter(ticket => {
            const ticketDate = new Date(ticket.datetime);
            return ticketDate >= selectedDate && ticketDate <= endDate;
        });

        const totalAmount = dayTickets.reduce((sum, ticket) => sum + ticket.total, 0);

        document.getElementById('currentSalesDate').textContent = selectedDate.toLocaleDateString('es-ES');
        document.getElementById('totalTickets').textContent = dayTickets.length;
        document.getElementById('totalSales').textContent = totalAmount.toFixed(2);

        displayTickets(dayTickets);
    }

    function showTodaySales() {
        const today = new Date();  // Obtiene la fecha y hora actuales
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');  // Los meses van de 0 a 11
        const day = String(today.getDate()).padStart(2, '0');
        const dateString = `${year}-${month}-${day}`;  // Formato YYYY-MM-DD
        document.getElementById('salesDate').value = dateString;
        showSalesByDate(dateString);
    }
    function generateTicket() {
        // Validar que haya n칰meros en el ticket
        if (numbers.length === 0) {
            showNotification('Agregue n칰meros al ticket');
            return;
        }

        // Obtener datos del formulario
        const lotteryType = document.getElementById('lotteryType').value;
        const drawTime = document.getElementById('drawTimeSelect').value;
        const customerName = document.getElementById('customerName').value;

        // Validaciones
        if (!lotteryType) {
            showNotification('Seleccione una loter칤a');
            return;
        }

        if (lotteryType !== 'PANAMA' && lotteryType !== 'REVENTADO_PANAMA' && !drawTime) {
            showNotification('Seleccione hora de sorteo');
            return;
        }

        // Validar horario antes de generar ticket
        if (!validarHorarioVenta(true)) {
            const drawTime = document.getElementById('drawTimeSelect').value;
            const lotteryType = document.getElementById('lotteryType').value;

            if (lotteryType !== 'PANAMA' && lotteryType !== 'REVENTADO_PANAMA') {
                showNotification('No se puede generar el ticket. Ventas bloqueadas 5 minutos antes y 20 minutos despu칠s del sorteo.', 'warning');
                return;
            }
        }



        // Agregar logs para depuraci칩n
        console.log("Generando ticket con los siguientes datos:", {
            loter칤a: lotteryType,
            horaSorteo: drawTime,
            cliente: customerName,
            n칰meros: numbers
        });

        try {
            // Crear ID 칰nico del ticket
            const ticketId = Date.now().toString();

            // Calcular el total correctamente (asegurando que subTotal sea un n칰mero)
            const totalAmount = numbers.reduce((sum, item) => {
                // Verificar que subTotal sea un n칰mero v치lido
                const subTotal = typeof item.subTotal === 'number' ? item.subTotal : parseFloat(item.subTotal);
                return sum + (isNaN(subTotal) ? 0 : subTotal);
            }, 0);

            // Crear objeto del ticket
            const ticket = {
                id: ticketId,
                datetime: new Date().toISOString(),
                lottery: lotteryType,
                drawTime: drawTime,
                numbers: JSON.parse(JSON.stringify(numbers)), // Clonar profundamente para evitar referencias
                total: totalAmount,
                paid: false, // Por defecto, el ticket no est치 pagado
                customerName: customerName // Guardar el nombre del cliente
            };

            // Cargar tickets existentes
            let tickets = loadTickets();

            // Verificar que tickets sea un array
            if (!Array.isArray(tickets)) {
                console.error("Error: tickets no es un array v치lido");
                tickets = [];
            }

            // A침adir nuevo ticket
            tickets.push(ticket);

            // Guardar en localStorage
            try {
                localStorage.setItem('lotteryTickets', JSON.stringify(tickets));
                console.log("Ticket guardado con 칠xito:", ticket);

                // Recalcular las ventas actuales despu칠s de generar el ticket
                calculateCurrentSales();

            } catch (storageError) {
                console.error("Error al guardar en localStorage:", storageError);
                showNotification("Error al guardar el ticket. Verifique el espacio disponible en su dispositivo.");
                return;
            }

            // Mostrar vista previa del ticket
            showTicketPreview(ticket);

            // Resetear formulario
            resetForm();

        } catch (error) {
            console.error("Error al generar el ticket:", error);
            showNotification("Ha ocurrido un error al generar el ticket. Por favor, intente nuevamente.");
        }
    }
    function resetForm() {
        // NO resetear los selectores de loter칤a y hora de sorteo
        // document.getElementById("lotteryType").selectedIndex = 0;
        // document.getElementById("drawTimeSelect").selectedIndex = 0;
        // document.getElementById("drawTimeSelect").disabled = true;

        // Limpiar el campo de nombre del cliente
        document.getElementById("customerName").value = "";

        // Limpiar campos de n칰mero y pedazos
        document.getElementById("number").value = "";
        document.getElementById("pieces").value = "";
        document.getElementById("quickInput").value = "";

        // Limpiar la lista de n칰meros
        numbers = [];
        document.getElementById("numbersTableBody").innerHTML = ""; // Limpiar la tabla
        document.getElementById("totalValue").innerText = "VALOR DE TICKET: 0.00$"; // Resetear el total
    }

    function showTicketPreview(ticket) {
        const preview = document.getElementById('ticketPreview');
        const content = document.getElementById('ticketContent');

        const ticketTime = new Date(ticket.datetime);
        const hours = ticketTime.getHours() % 12 || 12;
        const minutes = ticketTime.getMinutes().toString().padStart(2, '0');
        const ampm = ticketTime.getHours() >= 12 ? 'p. m.' : 'a. m.';
        const timeString = `${hours}:${minutes}`;

        content.innerHTML = `
        <div class="ticket-info" style="text-align: center; line-height: 1.2;">
            <p style="margin: 3px 0;"><strong>Fecha:</strong> ${ticketTime.toLocaleDateString('es-ES')}</p>
            <p style="margin: 3px 0;"><strong>Hora venta:</strong> ${timeString} ${ampm}</p>
            <p style="margin: 3px 0;"><strong>Loteria:</strong> ${getDisplayName(ticket.lottery)}</p>
            ${ticket.drawTime ? `<p style="margin: 3px 0;"><strong>Hora sorteo:</strong> ${ticket.drawTime}</p>` : ''}
            <p style="margin: 3px 0;"><strong>Vendedor:</strong> ${sellerName}</p>
            <p style="margin: 6px 0 3px 0;"><strong>ID Ticket:</strong></p>
            <p style="margin: 3px 0;">${ticket.id}</p>
        </div>
        <div class="ticket-numbers" style="border-top: 1px solid black; border-bottom: 1px solid black; margin: 20px 0; padding: 20px 0;">
            ${ticket.numbers.map(n => `
                <p style="font-family: monospace; font-size: 1.4em; margin: 10px 0; text-align: center;">*${n.number}*/${n.pieces}T/${n.subTotal.toFixed(2)}$</p>
            `).join('')}
        </div>
        <div style="text-align: center;">
            <p style="font-size: 1.6em; margin: 15px 0;"><strong>Total:</strong> ${ticket.total.toFixed(2)}$</p>
            ${ticket.customerName ? `<p style="margin: 15px 0; font-size: 1.2em;"><strong>Cliente:</strong> ${ticket.customerName}</p>` : ''}
            <p style="margin: 4px 0; font-size: 1.2em;">SIN TICKET NO HAY RECLAMO</p>
            <p style="margin: 2px 0; font-size: 1.2em;">APM11</p>
        </div>
    `;

        const qrDiv = document.getElementById('qrcode');
        qrDiv.innerHTML = '';
        new QRCode(qrDiv, {
            text: ticket.id,
            width: 100,
            height: 100,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H
        });

        // Botones: solo mostrar "MARCAR COMO PAGADO" si NO est치 pagado
        if (ticket.paid) {
            actionsDiv.innerHTML = `
        <button style="background: linear-gradient(135deg, #e74c3c 0%, #dc3545 100%); color: white; cursor: not-allowed; border: 2px solid #c82333;" disabled>PAGADO</button>
        <button onclick="copyTicket('${ticket.id}')">COPIAR</button>
        <button onclick="closeTicket()">CERRAR</button>
        <button onclick="compartirTicket()">COMPARTIR</button>
    `;
        } else {
            actionsDiv.innerHTML = `
        <button onclick="marcarComoPagado('${ticket.id}')" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">COBRAR</button>
        <button onclick="copyTicket('${ticket.id}')">COPIAR</button>
        <button onclick="closeTicket()">CERRAR</button>
        <button onclick="compartirTicket()">COMPARTIR</button>
    `;
        }

        preview.style.display = 'block';
    }
    function closeTicket() {
        document.getElementById('ticketPreview').style.display = 'none';
        numbers = [];
        updateNumbersList();
        updateTotal();
    }

    function loadTickets() {
        const savedTickets = localStorage.getItem('lotteryTickets');
        return savedTickets ? JSON.parse(savedTickets) : [];
    }

    function showSalesPage() {
        closeMenu();
        // Ocultar todas las p치ginas excepto la de ventas
        document.getElementById('mainPage').style.display = 'none';
        document.getElementById('salesPage').style.display = 'block';
        document.getElementById('numberSalesPage').style.display = 'none';
        displayTickets(); // Actualizar la lista de tickets
        showTodaySales(); // Mostrar las ventas de hoy
    }

    window.onload = function () {
        // Reiniciar los valores de los elementos
        document.getElementById('customerName').value = '';
        document.getElementById('lotteryType').selectedIndex = 0;
        document.getElementById('drawTimeSelect').selectedIndex = 0;
        document.getElementById('drawTimeSelect').disabled = true;
        document.getElementById('number').value = '';
        document.getElementById('pieces').value = '';
    };

    function displayTickets(ticketsToShow = null) {
        const ticketsList = document.getElementById('ticketsList');
        const tickets = ticketsToShow || loadTickets();

        ticketsList.innerHTML = tickets.map(ticket => `
            <div class="ticket-item">
                <p><strong>ID:</strong> ${ticket.id}</p>
                <p><strong>Fecha:</strong> ${new Date(ticket.datetime).toLocaleString()}</p>
                <p><strong>Loter칤a:</strong> ${ticket.lottery}</p>
                ${ticket.customerName ? `<p><strong>Cliente:</strong> ${ticket.customerName}</p>` : ''}
                <p><strong>Total:</strong> ${ticket.total.toFixed(2)}</p>
                <p><strong>Estado:</strong> ${ticket.paid ? 'Pagado' : 'Pendiente'}</p>
                <div class="ticket-actions">
                    <button onclick="viewTicket('${ticket.id}')">Ver</button>
                    <button onclick="deleteTicket('${ticket.id}')">clear</button>
                    <button onclick="copyTicket('${ticket.id}')">copy</button>
                    ${!ticket.paid ? `<button onclick="marcarComoPagado('${ticket.id}')">cobrar</button>` : ''}
                </div>
            </div>
        `).join('');
    }

    function viewTicket(ticketId) {
        const tickets = loadTickets();
        const ticket = tickets.find(t => t.id === ticketId);
        if (ticket) {
            showMainPageOnly(); // Usar la nueva funci칩n
            showTicketPreview(ticket);
        }
    }

    function copyTicket(ticketId) {
        const tickets = loadTickets();
        const ticket = tickets.find(t => t.id === ticketId);

        if (ticket) {
            // Cerrar la vista previa del ticket si est치 abierta
            const ticketPreview = document.getElementById('ticketPreview');
            if (ticketPreview && ticketPreview.style.display === 'block') {
                closeTicket();
            }

            // Cargar los n칰meros del ticket en la variable global `numbers`
            numbers = ticket.numbers.map(num => ({
                number: num.number,
                pieces: num.pieces,
                subTotal: num.subTotal
            }));

            // Actualizar la lista de n칰meros en la interfaz
            updateNumbersList();
            updateTotal();

            // Cambiar a la p치gina principal
            showMainPage();

            // Mostrar un mensaje al usuario
            showNotification("Los numeros del ticket han sido copiados. Cambia la loteria y la hora de sorteo antes de generar el nuevo ticket.");
        } else {
            showNotification("Ticket no encontrado.");
        }
    }

    function showTicketPreview(ticket) {
        const preview = document.getElementById('ticketPreview');
        const content = document.getElementById('ticketContent');

        const ticketTime = new Date(ticket.datetime);
        const hours = ticketTime.getHours() % 12 || 12;
        const minutes = ticketTime.getMinutes().toString().padStart(2, '0');
        const ampm = ticketTime.getHours() >= 12 ? 'p. m.' : 'a. m.';
        const timeString = `${hours}:${minutes}`;

        content.innerHTML = `
        <div class="ticket-info" style="text-align: center; line-height: 1.2;">
            <p style="margin: 3px 0;"><strong>Fecha:</strong> ${ticketTime.toLocaleDateString('es-ES')}</p>
            <p style="margin: 3px 0;"><strong>Hora venta:</strong> ${timeString} ${ampm}</p>
            <p style="margin: 3px 0;"><strong>Loteria:</strong> ${getDisplayName(ticket.lottery)}</p>
            ${ticket.drawTime ? `<p style="margin: 3px 0;"><strong>Hora sorteo:</strong> ${ticket.drawTime}</p>` : ''}
            <p style="margin: 3px 0;"><strong>Vendedor:</strong> ${sellerName}</p>
            <p style="margin: 6px 0 3px 0;"><strong>ID Ticket:</strong></p>
            <p style="margin: 3px 0;">${ticket.id}</p>
        </div>
        <div class="ticket-numbers" style="border-top: 1px solid black; border-bottom: 1px solid black; margin: 20px 0; padding: 20px 0;">
            ${ticket.numbers.map(n => `
                <p style="font-family: monospace; font-size: 1.4em; margin: 10px 0; text-align: center;">*${n.number}*/${n.pieces}T/${n.subTotal.toFixed(2)}$</p>
            `).join('')}
        </div>
        <div style="text-align: center;">
            <p style="font-size: 1.6em; margin: 15px 0;"><strong>Total:</strong> ${ticket.total.toFixed(2)}$</p>
            ${ticket.customerName ? `<p style="margin: 15px 0; font-size: 1.2em;"><strong>Cliente:</strong> ${ticket.customerName}</p>` : ''}
            <p style="margin: 4px 0; font-size: 1.2em;">SIN TICKET NO HAY RECLAMO</p>
            <p style="margin: 2px 0; font-size: 1.2em;">APM11</p>
        </div>
    `;

        const qrDiv = document.getElementById('qrcode');
        qrDiv.innerHTML = '';
        new QRCode(qrDiv, {
            text: ticket.id,
            width: 100,
            height: 100,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H
        });

        // Botones organizados: arriba COBRAR/COPIAR, abajo CERRAR/COMPARTIR
        const actionsDiv = preview.querySelector('.ticket-actions');
        if (ticket.paid) {
            actionsDiv.innerHTML = `
            <button style="background: linear-gradient(135deg, #e74c3c 0%, #dc3545 100%) !important; color: white !important; cursor: not-allowed !important; border: 2px solid #c82333 !important;" disabled>PAGADO</button>
            <button onclick="copyTicket('${ticket.id}')">COPIAR</button>
            <button onclick="closeTicket()">CERRAR</button>
            <button onclick="compartirTicket()">COMPARTIR</button>
        `;
        } else {
            actionsDiv.innerHTML = `
            <button onclick="marcarComoPagado('${ticket.id}')" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">COBRAR</button>
            <button onclick="copyTicket('${ticket.id}')">COPIAR</button>
            <button onclick="closeTicket()">CERRAR</button>
            <button onclick="compartirTicket()">COMPARTIR</button>
        `;
        }

        preview.style.display = 'block';
    }

    function deleteTicket(ticketId) {
        let tickets = loadTickets();
        const ticketToDelete = tickets.find(t => t.id === ticketId);

        if (ticketToDelete) {
            // Validar horario pasando directamente los datos del ticket
            const validationResult = validarHorarioEliminacion(ticketToDelete.lottery, ticketToDelete.drawTime);

            if (!validationResult.allowed) {
                const message = getEliminationBlockMessage(validationResult);
                showNotification(message, 'warning', 6000);
                return;
            }

            // Proceder con la eliminaci칩n normal
            showConfirm('쮼st치 seguro de eliminar este ticket?', 'Eliminar Ticket', () => {
                tickets = tickets.filter(t => t.id !== ticketId);
                localStorage.setItem('lotteryTickets', JSON.stringify(tickets));
                displayTickets();

                // Recalcular las ventas actuales despu칠s de eliminar el ticket
                calculateCurrentSales();

                const currentDate = document.getElementById('salesDate').value;
                if (currentDate) {
                    showSalesByDate(currentDate);
                }

                showNotification('Ticket eliminado correctamente', 'success');
            });
        } else {
            showNotification('Ticket no encontrado', 'error');
        }
    }
    function searchTickets() {
        const searchValue = document.getElementById('searchInput').value.toLowerCase();
        const tickets = loadTickets();
        const filteredTickets = tickets.filter(ticket =>
            ticket.id.toLowerCase().includes(searchValue)
        );
        displayTickets(filteredTickets);
    }

    async function compartirTicket() {
        try {
            const ticketElement = document.getElementById('ticketPreview');
            const actionButtons = ticketElement.querySelector('.ticket-actions');

            // Ocultar los botones y esperar un momento para asegurar que se aplique
            actionButtons.style.display = 'none';
            actionButtons.style.visibility = 'hidden';

            // Esperar un poco para asegurar que los cambios se apliquen
            await new Promise(resolve => setTimeout(resolve, 100));

            const canvas = await html2canvas(ticketElement, {
                scale: 2,
                backgroundColor: '#ffffff',
                logging: false,
                useCORS: true,
                allowTaint: true
            });

            // Restaurar los botones
            actionButtons.style.display = 'grid';
            actionButtons.style.visibility = 'visible';

            const base64 = canvas.toDataURL('image/png');
            Android.shareTicketFromAndroid(base64);
        } catch (error) {
            console.error('Error al compartir:', error);
            showNotification('No se pudo compartir el ticket. Intente de nuevo.');

            // Asegurar que los botones se restauren incluso si hay error
            const ticketElement = document.getElementById('ticketPreview');
            const actionButtons = ticketElement.querySelector('.ticket-actions');
            if (actionButtons) {
                actionButtons.style.display = 'grid';
                actionButtons.style.visibility = 'visible';
            }
        }
    }

    let html5QrcodeScanner = null;

    async function toggleScanner() {
        const scannerContainer = document.getElementById('scannerContainer');

        if (scannerContainer.style.display === 'none' || !scannerContainer.style.display) {
            // Verificar permisos antes de mostrar
            if (typeof Android !== 'undefined') {
                const hasPermission = Android.hasCameraPermission();
                if (!hasPermission) {
                    showNotification('丘멆잺 No se puede acceder a la c치mara. La app necesita permisos de c치mara para escanear c칩digos QR.', 'warning', 6000);
                    return;
                }
            }

            scannerContainer.style.display = 'block';
            await iniciarEscaner();
        } else {
            scannerContainer.style.display = 'none';
            if (html5QrcodeScanner) {
                try {
                    await html5QrcodeScanner.clear();
                    html5QrcodeScanner = null;
                } catch (error) {
                    console.error("Error al cerrar scanner:", error);
                    if (typeof Android !== 'undefined') {
                        Android.logFromJS("Error al cerrar scanner: " + error.message);
                    }
                }
            }
        }
    }
    function verificarTicket(ticket) {
        if (ticket.paid) {
            showNotification('丘멆잺 Este ticket ya ha sido pagado anteriormente', 'warning');
        } else {
            showNotification('游늯 Ticket encontrado', 'success');
        }

        // Cambiar a p치gina principal sin cerrar vista previa
        showMainPageOnly();

        // Mostrar la vista previa del ticket
        setTimeout(() => {
            showTicketPreview(ticket);
        }, 200);
    }

    function showMainPageOnly() {
        // Ocultar todas las p치ginas excepto la principal
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('salesPage').style.display = 'none';
        document.getElementById('numberSalesPage').style.display = 'none';
        document.getElementById('verifyWinnersPage').style.display = 'none';
        document.getElementById('configPage').style.display = 'none';

        // Mostrar la p치gina principal (SIN cerrar vista previa)
        document.getElementById('mainPage').style.display = 'block';

        // Solo limpiamos los campos de entrada de n칰meros, pero mantenemos la loter칤a y hora
        document.getElementById('number').value = '';
        document.getElementById('pieces').value = '';
        document.getElementById('quickInput').value = '';
    }

    function marcarComoPagado(ticketId) {
        let tickets = loadTickets();
        const ticketIndex = tickets.findIndex(t => t.id === ticketId);
        if (ticketIndex !== -1) {
            tickets[ticketIndex].paid = true;
            localStorage.setItem('lotteryTickets', JSON.stringify(tickets));

            showNotification('九 Ticket marcado como pagado correctamente', 'success');

            // Actualizar la vista previa del ticket (sin mostrar estado)
            showTicketPreview(tickets[ticketIndex]);

            // Actualizar la lista de tickets si estamos en la p치gina de ventas
            const salesPage = document.getElementById('salesPage');
            if (salesPage.style.display !== 'none') {
                displayTickets();
                const currentDate = document.getElementById('salesDate').value;
                if (currentDate) {
                    showSalesByDate(currentDate);
                }
            }

            // Recalcular las ventas actuales despu칠s de marcar como pagado
            calculateCurrentSales();
        } else {
            showNotification('仇 Ticket no encontrado', 'error');
        }
    }

    // Tambi칠n modifica la funci칩n showNumberSalesPage para mostrar el resumen inmediatamente
    function showNumberSalesPage() {
        closeMenu();
        document.getElementById('mainPage').style.display = 'none';
        document.getElementById('salesPage').style.display = 'none';
        document.getElementById('numberSalesPage').style.display = 'block';
        document.getElementById('verifyWinnersPage').style.display = 'none';

        // Establecer la fecha actual como valor por defecto si no hay fecha seleccionada
        if (!document.getElementById('salesFilterDate').value) {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            document.getElementById('salesFilterDate').value = `${year}-${month}-${day}`;
        }

        // CAMBIO: Mostrar el resumen inmediatamente al cargar la p치gina
        displaySalesSummary(activeTab);

        updateNumberSalesTable(); // Actualizar la cuadr칤cula al mostrar la p치gina
    }
    // Funci칩n para actualizar los tiempos de sorteo en los filtros
    function updateFilterDrawTimes() {
        const lotteryType = document.getElementById('filterLotteryType').value;
        const timeSelect = document.getElementById('filterDrawTimeSelect');
        timeSelect.innerHTML = '<option value="">Todas las Horas</option>';

        const baseLottery = getBaseLottery(lotteryType);

        if (lotteryType && baseLottery !== 'PANAMA') {
            timeSelect.disabled = false;
            lotteryTimes[lotteryType].forEach(time => {
                timeSelect.innerHTML += `<option value="${time}">${time}</option>`;
            });
        } else {
            timeSelect.disabled = true;
        }
    }

    function applyFilters() {
        if (activeTab === 'tiempos') {
            updateNumberSalesTable();
            // Cargar n칰meros ganadores para los nuevos filtros
            setTimeout(() => {
                loadAndDisplayWinningNumbers();
            }, 100);
        } else {
            updateBilletesSalesTable();
        }
    }


    // Funci칩n modificada para tiempos vendidos
    function updateNumberSalesTable() {
        const tickets = loadTickets();
        const filterLottery = document.getElementById('filterLotteryType').value;
        const filterTime = document.getElementById('filterDrawTimeSelect').value;
        const filterDate = document.getElementById('salesFilterDate').value;

        // Inicializar un objeto para contar los tiempos vendidos por n칰mero
        const numberSales = {};
        for (let i = 0; i <= 99; i++) {
            const number = i.toString().padStart(2, '0'); // Formato 00, 01, ..., 99
            numberSales[number] = 0; // Inicializar en 0 (n칰mero)
        }

        // Crear objetos Date para el rango del d칤a seleccionado si hay un filtro de fecha
        let selectedDateStart = null;
        let selectedDateEnd = null;

        if (filterDate) {
            selectedDateStart = new Date(filterDate + 'T00:00:00');
            selectedDateEnd = new Date(filterDate + 'T23:59:59');
        }

        // Filtrar y contar los tiempos vendidos
        tickets.forEach(ticket => {
            // Convertir la fecha del ticket a un objeto Date para comparaci칩n
            const ticketDate = new Date(ticket.datetime);

            // Verificar si pasa los filtros
            let passesFilters = true;

            // Filtro de loter칤a
            if (filterLottery && ticket.lottery !== filterLottery) {
                passesFilters = false;
            }

            // Filtro de hora de sorteo
            if (filterTime && ticket.drawTime !== filterTime) {
                passesFilters = false;
            }

            // Filtro de fecha - comparar objetos Date para incluir horas
            if (filterDate && (ticketDate < selectedDateStart || ticketDate > selectedDateEnd)) {
                passesFilters = false;
            }

            // Si pasa todos los filtros, contar los tiempos vendidos
            if (passesFilters) {
                ticket.numbers.forEach(num => {
                    if (num.number.length === 2) { // Solo contar n칰meros de 2 cifras
                        numberSales[num.number] += parseInt(num.pieces, 10);
                    }
                });
            }
        });

        // Mostrar los resultados en la cuadr칤cula
        const grid = document.getElementById('numberSalesGrid');
        grid.innerHTML = '';

        // Recorrer los n칰meros en orden num칠rico (00, 01, 02, ..., 99)
        for (let i = 0; i <= 99; i++) {
            const number = i.toString().padStart(2, '0'); // Formato 00, 01, ..., 99
            const numberItem = document.createElement('div');
            numberItem.className = 'number-item';

            // Aplicar la clase "highlight" si el n칰mero tiene tiempos vendidos mayores a cero
            if (numberSales[number] > 0) {
                numberItem.classList.add('highlight');
            }

            numberItem.innerHTML = `
            <span>${number}</span>
            <span>${numberSales[number]}</span>
        `;
            grid.appendChild(numberItem);
        }

        // CAMBIO: Siempre mostrar el resumen, sin condici칩n
        displaySalesSummary('tiempos');
    }


    function deleteSalesByDate() {
        const selectedDate = document.getElementById('salesDate').value;

        if (!selectedDate) {
            showNotification("Por favor, seleccione una fecha primero", 'warning');
            return;
        }

        showConfirm(
            `쮼st치 seguro de borrar todas las ventas del ${selectedDate}? Esta acci칩n no se puede deshacer.`,
            'Borrar Ventas del D칤a',
            () => {
                let tickets = loadTickets();

                // Filtrar los tickets que NO coincidan con la fecha seleccionada
                const filteredTickets = tickets.filter(ticket => {
                    const ticketDate = new Date(ticket.datetime);

                    // Extraer componentes de fecha en la zona horaria local
                    const ticketYear = ticketDate.getFullYear();
                    const ticketMonth = String(ticketDate.getMonth() + 1).padStart(2, '0');
                    const ticketDay = String(ticketDate.getDate()).padStart(2, '0');
                    const ticketDateStr = `${ticketYear}-${ticketMonth}-${ticketDay}`;

                    // Comparar con la fecha seleccionada
                    return ticketDateStr !== selectedDate;
                });

                // Guardar los tickets filtrados en localStorage
                localStorage.setItem('lotteryTickets', JSON.stringify(filteredTickets));

                // Actualizar la lista de tickets
                displayTickets();
                showSalesByDate(selectedDate); // Actualizar el resumen de ventas

                showNotification(`Todas las ventas del ${selectedDate} han sido borradas`, 'success');
            }
        );
    }

    function processQuickInput() {
        const input = document.getElementById('quickInput').value.trim();

        if (!input) {
            showNotification('Por favor ingrese al menos un n칰mero en formato "n칰mero,tiempos"');
            return;
        }

        // Verificar la loter칤a seleccionada
        const lotteryType = document.getElementById('lotteryType').value;
        if (!lotteryType) {
            showNotification('Por favor seleccione una loter칤a');
            return;
        }

        // Verificar hora de sorteo para loter칤as que no sean PANAMA
        if (lotteryType !== 'PANAMA') {
            const drawTime = document.getElementById('drawTimeSelect').value;
            if (!drawTime) {
                showNotification('Por favor seleccione hora de sorteo');
                return;
            }
        }

        // Buscar todos los patrones que coincidan con "n칰mero,tiempos"
        const matches = input.match(/\d+,\d+/g);

        if (!matches || matches.length === 0) {
            showNotification('No se encontraron n칰meros en formato v치lido (n칰mero,tiempos)');
            return;
        }

        let processed = 0;

        for (let i = 0; i < matches.length; i++) {
            const match = matches[i];
            // Separar el n칰mero y los tiempos
            const [number, piecesStr] = match.split(',');

            // Validar el n칰mero (debe tener 2 o 4 cifras)
            if (validateNumber(number)) {
                // Convertir tiempos a n칰mero
                const pieces = parseInt(piecesStr, 10);

                // Solo procesar si los tiempos son un n칰mero positivo
                if (!isNaN(pieces) && pieces > 0) {
                    // Validar horario antes de verificar l칤mites
                    // Validar horario antes de verificar l칤mites
                    if (!validarHorarioVenta()) {
                        continue; // Saltar este n칰mero y continuar con el siguiente
                    }
                    // Verificar l칤mites antes de agregar el n칰mero
                    if (!checkLimits(number, pieces)) {
                        continue; // Si no pasa la verificaci칩n de l칤mites, pasar al siguiente n칰mero
                    }


                    // Calcular el subtotal
                    const subTotal = calculatePrice(number, pieces, lotteryType);

                    // Agregar a la lista de n칰meros
                    numbers.push({ number, pieces, subTotal });
                    // Actualizar el contador de ventas actuales para este n칰mero
                    updateCurrentSales(number, pieces, true); // true indica que es una adici칩n

                    processed++;
                }
            }
        }

        // Actualizar la tabla y el total si se proces칩 al menos un n칰mero
        if (processed > 0) {
            updateNumbersList();
            updateTotal();
            document.getElementById('quickInput').value = ''; // Limpiar el campo
            showNotification(`Se procesaron ${processed} n칰meros correctamente.`);
        } else if (matches.length > 0 && processed === 0) {
            showNotification('No se pudieron procesar los n칰meros debido a los l칤mites establecidos, formato incorrecto o hora limite del sorteo.');
        } else {
            showNotification('No se pudieron procesar los n칰meros. Aseg칰rese de que los n칰meros tengan 2 o 4 cifras y los tiempos sean valores positivos.');
        }
    }

    function shareReport(type) {
        const tickets = loadTickets();
        const filterLottery = document.getElementById('filterLotteryType').value;
        const filterTime = document.getElementById('filterDrawTimeSelect').value;
        const filterDate = document.getElementById('salesFilterDate').value;

        // Inicializar objetos para contar ventas
        const sales = {};

        // Crear objetos Date para el rango del d칤a seleccionado si hay un filtro de fecha
        let selectedDateStart = null;
        let selectedDateEnd = null;

        if (filterDate) {
            selectedDateStart = new Date(filterDate + 'T00:00:00');
            selectedDateEnd = new Date(filterDate + 'T23:59:59');
        }

        // Filtrar y contar ventas
        tickets.forEach(ticket => {
            // Convertir la fecha del ticket a un objeto Date para comparaci칩n
            const ticketDate = new Date(ticket.datetime);

            // Verificar si pasa los filtros
            let passesFilters = true;

            // Filtro de loter칤a
            if (filterLottery && ticket.lottery !== filterLottery) {
                passesFilters = false;
            }

            // Filtro de hora de sorteo
            if (filterTime && ticket.drawTime !== filterTime) {
                passesFilters = false;
            }

            // Filtro de fecha - comparar objetos Date para incluir horas
            if (filterDate && (ticketDate < selectedDateStart || ticketDate > selectedDateEnd)) {
                passesFilters = false;
            }

            // Si pasa todos los filtros, contar ventas
            if (passesFilters) {
                ticket.numbers.forEach(num => {
                    // Para tiempos (2 cifras) o billetes (4 cifras) seg칰n el tipo
                    if ((type === 'tiempos' && num.number.length === 2) ||
                        (type === 'billetes' && num.number.length === 4)) {
                        if (!sales[num.number]) {
                            sales[num.number] = 0;
                        }
                        sales[num.number] += parseInt(num.pieces, 10);
                    }
                });
            }
        });

        // Crear el contenido del reporte
        let reportContent = `Reporte de ${type === 'tiempos' ? 'Tiempos' : 'Billetes'} Vendidos\n`;
        reportContent += `Loter칤a: ${filterLottery || 'Todas'}\n`;
        reportContent += `Hora de Sorteo: ${filterTime || 'Todas'}\n`;
        reportContent += `Fecha: ${filterDate || 'Todas'}\n\n`;
        reportContent += type === 'tiempos' ? "N칰mero,Tiempos Vendidos\n" : "Billete,Cantidad Vendida\n";

        // Agregar n칰meros/billetes con cantidades vendidas mayores a cero
        const sortedNumbers = Object.keys(sales).sort();
        sortedNumbers.forEach(number => {
            if (sales[number] > 0) {
                reportContent += `${number},${sales[number]}\n`;
            }
        });

        // Agregar console.log para depuraci칩n
        console.log(`Reporte de ${type} generado:`, reportContent);

        Android.shareReportFromAndroid(reportContent, type);
    }


    // Funci칩n para verificar tickets ganadores
    function checkWinningTickets() {
        console.log("Iniciando verificaci칩n de tickets ganadores");

        const firstPrize = document.getElementById('firstPrize').value.trim();
        const secondPrize = document.getElementById('secondPrize').value.trim();
        const thirdPrize = document.getElementById('thirdPrize').value.trim();

        if (!firstPrize || !secondPrize || !thirdPrize) {
            showNotification("Por favor, ingrese los n칰meros ganadores.");
            return;
        }

        // Obtener los valores de los filtros - USAR IDs CORRECTOS
        const filterDateInput = document.getElementById('winnersFilterDate').value;
        const filterLottery = document.getElementById('filterLottery').value;
        const filterDrawTime = document.getElementById('filterDrawTime').value;

        console.log("Filtros seleccionados:", {
            fecha: filterDateInput,
            loteria: filterLottery,
            horaSorteo: filterDrawTime
        });

        // Si no hay ning칰n filtro seleccionado, mostrar una advertencia
        if (!filterDateInput && !filterLottery && !filterDrawTime) {
            if (!confirm("No ha seleccionado ning칰n filtro. 쮻esea verificar TODOS los tickets existentes?")) {
                return;
            }
        }

        const tickets = loadTickets();
        console.log("Total de tickets cargados:", tickets.length);

        let filteredTickets = [...tickets]; // Crear una copia para no modificar el original

        // Aplicar filtro de fecha - CORRECCI칍N IMPLEMENTADA AQU칈
        if (filterDateInput) {
            console.log("Filtrando por fecha:", filterDateInput);

            filteredTickets = filteredTickets.filter(ticket => {
                // Convertir la fecha del ticket a formato local para evitar problemas de zona horaria
                const ticketDate = new Date(ticket.datetime);

                // Extraer componentes de fecha en la zona horaria local
                const ticketYear = ticketDate.getFullYear();
                const ticketMonth = String(ticketDate.getMonth() + 1).padStart(2, '0');
                const ticketDay = String(ticketDate.getDate()).padStart(2, '0');
                const ticketDateStr = `${ticketYear}-${ticketMonth}-${ticketDay}`;

                // Comparar con la fecha del filtro
                const coincide = ticketDateStr === filterDateInput;

                if (coincide) {
                    console.log("Ticket coincide con fecha:", ticket.id, ticketDateStr);
                }

                return coincide;
            });
        }

        console.log("Tickets despu칠s de filtrar por fecha:", filteredTickets.length);

        // Aplicar filtro de loter칤a
        if (filterLottery) {
            console.log("Filtrando por loter칤a:", filterLottery);
            filteredTickets = filteredTickets.filter(ticket => ticket.lottery === filterLottery);
        }

        console.log("Tickets despu칠s de filtrar por loter칤a:", filteredTickets.length);

        // Aplicar filtro de hora de sorteo
        if (filterDrawTime) {
            console.log("Filtrando por hora de sorteo:", filterDrawTime);
            filteredTickets = filteredTickets.filter(ticket => ticket.drawTime === filterDrawTime);
        }

        console.log("Tickets despu칠s de filtrar por hora de sorteo:", filteredTickets.length);

        // Mostrar mensaje si no hay tickets que coincidan con los filtros
        if (filteredTickets.length === 0) {
            showNotification("No hay tickets que coincidan con los filtros seleccionados.");
            return;
        }

        // Buscar tickets ganadores entre los tickets filtrados
        const winningTickets = [];

        filteredTickets.forEach(ticket => {
            ticket.numbers.forEach(num => {
                const ticketNumber = num.number;
                let isPrize = false;
                let prizeType = '';

                if (ticketNumber === firstPrize) {
                    isPrize = true;
                    prizeType = '1er Premio';
                } else if (ticketNumber === secondPrize) {
                    isPrize = true;
                    prizeType = '2do Premio';
                } else if (ticketNumber === thirdPrize) {
                    isPrize = true;
                    prizeType = '3er Premio';
                }

                if (isPrize) {
                    // Formatear la fecha en un formato legible
                    const ticketDate = new Date(ticket.datetime);
                    const formattedDate = `${ticketDate.getDate()}/${ticketDate.getMonth() + 1}/${ticketDate.getFullYear()}`;

                    winningTickets.push({
                        id: ticket.id,
                        lottery: ticket.lottery,
                        drawTime: ticket.drawTime,
                        date: formattedDate,
                        number: ticketNumber,
                        pieces: num.pieces,
                        prize: prizeType
                    });

                    console.log("Ticket ganador encontrado:", {
                        id: ticket.id,
                        fecha: formattedDate,
                        loteria: ticket.lottery,
                        horaSorteo: ticket.drawTime,
                        numero: ticketNumber,
                        premio: prizeType
                    });
                }
            });
        });

        if (winningTickets.length > 0) {
            console.log("Total tickets ganadores encontrados:", winningTickets.length);
            displayWinningTickets(winningTickets);
        } else {
            showNotification("No hay tickets ganadores con los n칰meros ingresados en los filtros seleccionados.");
        }
    }


    // Funci칩n para mostrar los tickets ganadores
    function displayWinningTickets(winningTickets) {
        const resultDiv = document.getElementById('winningTicketsResult');
        resultDiv.innerHTML = `
            <h3>Tickets Ganadores</h3>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th style="border: 1px solid #ccc; padding: 8px;">ID Ticket</th>
                        <th style="border: 1px solid #ccc; padding: 8px;">Fecha</th>
                        <th style="border: 1px solid #ccc; padding: 8px;">Loter칤a</th>
                        <th style="border: 1px solid #ccc; padding: 8px;">Hora Sorteo</th>
                        <th style="border: 1px solid #ccc; padding: 8px;">N칰mero</th>
                        <th style="border: 1px solid #ccc; padding: 8px;">Tiempos</th>
                        <th style="border: 1px solid #ccc; padding: 8px;">Premio</th>
                    </tr>
                </thead>
                <tbody>
                    ${winningTickets.map(ticket => `
                        <tr>
                            <td style="border: 1px solid #ccc; padding: 8px;">${ticket.id}</td>
                            <td style="border: 1px solid #ccc; padding: 8px;">${ticket.date}</td>
                            <td style="border: 1px solid #ccc; padding: 8px;">${ticket.lottery}</td>
                            <td style="border: 1px solid #ccc; padding: 8px;">${ticket.drawTime || 'N/A'}</td>
                            <td style="border: 1px solid #ccc; padding: 8px;">${ticket.number}</td>
                            <td style="border: 1px solid #ccc; padding: 8px;">${ticket.pieces}</td>
                            <td style="border: 1px solid #ccc; padding: 8px;">${ticket.prize}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
    }

    function applyWinnerFilters() {
        const filterDate = document.getElementById('winnersFilterDate').value; // Usar el ID correcto
        const filterLottery = document.getElementById('filterLottery').value;
        const filterDrawTime = document.getElementById('filterDrawTime').value;


        const tickets = loadTickets();
        const filteredTickets = tickets.filter(ticket => {
            const ticketDate = new Date(ticket.datetime).toISOString().split('T')[0];
            return (!filterDate || ticketDate === filterDate) &&
                (!filterLottery || ticket.lottery === filterLottery) &&
                (!filterDrawTime || ticket.drawTime === filterDrawTime);
        });

        if (filteredTickets.length > 0) {
            displayFilteredTickets(filteredTickets);
        } else {
            showNotification("No hay tickets que coincidan con los filtros seleccionados.");
        }
    }

    function displayFilteredTickets(filteredTickets) {
        const resultDiv = document.createElement('div');
        resultDiv.innerHTML = `
            <h3>Tickets Filtrados</h3>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th style="border: 1px solid #ccc; padding: 8px;">ID Ticket</th>
                        <th style="border: 1px solid #ccc; padding: 8px;">Fecha</th>
                        <th style="border: 1px solid #ccc; padding: 8px;">Loter칤a</th>
                        <th style="border: 1px solid #ccc; padding: 8px;">Hora de Sorteo</th>
                        <th style="border: 1px solid #ccc; padding: 8px;">N칰meros</th>
                    </tr>
                </thead>
                <tbody>
                    ${filteredTickets.map(ticket => `
                        <tr>
                            <td style="border: 1px solid #ccc; padding: 8px;">${ticket.id}</td>
                            <td style="border: 1px solid #ccc; padding: 8px;">${new Date(ticket.datetime).toLocaleDateString()}</td>
                            <td style="border: 1px solid #ccc; padding: 8px;">${ticket.lottery}</td>
                            <td style="border: 1px solid #ccc; padding: 8px;">${ticket.drawTime || 'N/A'}</td>
                            <td style="border: 1px solid #ccc; padding: 8px;">
                                ${ticket.numbers.map(num => `${num.number} (${num.pieces}T)`).join(', ')}
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;

        // Mostrar el resultado en la p치gina
        const mainPage = document.getElementById('mainPage');
        mainPage.appendChild(resultDiv);
    }

    // Funci칩n para mostrar la p치gina de verificaci칩n de ganadores
    function showVerifyWinnersPage() {
        closeMenu();
        document.getElementById('mainPage').style.display = 'none';
        document.getElementById('salesPage').style.display = 'none';
        document.getElementById('numberSalesPage').style.display = 'none';
        document.getElementById('verifyWinnersPage').style.display = 'block';
        document.getElementById('winningTicketsResult').innerHTML = ''; // Limpiar resultados anteriores

        // Agregar evento de cambio al selector de loter칤a
        document.getElementById('filterLottery').onchange = updateWinnerDrawTimes;

        // Inicializar las horas de sorteo
        updateWinnerDrawTimes();

        // Resetear los campos de premios
        document.getElementById('firstPrize').value = '';
        document.getElementById('secondPrize').value = '';
        document.getElementById('thirdPrize').value = '';

        // Establecer la fecha actual como valor predeterminado
        if (!document.getElementById('winnersFilterDate').value) {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            document.getElementById('winnersFilterDate').value = `${year}-${month}-${day}`;
        }
    }

    // Funci칩n para volver a la p치gina principal
    function showMainPage() {
        // Ocultar todas las p치ginas excepto la principal
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('salesPage').style.display = 'none';
        document.getElementById('numberSalesPage').style.display = 'none';
        document.getElementById('verifyWinnersPage').style.display = 'none';
        document.getElementById('configPage').style.display = 'none';

        // Cerrar vista previa del ticket si est치 abierta
        document.getElementById('ticketPreview').style.display = 'none';

        // Mostrar la p치gina principal
        document.getElementById('mainPage').style.display = 'block';

        // Solo limpiamos los campos de entrada de n칰meros, pero mantenemos la loter칤a y hora
        document.getElementById('number').value = '';
        document.getElementById('pieces').value = '';
        document.getElementById('quickInput').value = '';
    }
    function resetMainPage() {
        // Limpiar solo los campos espec칤ficos, pero NO reiniciar loter칤a ni hora
        document.getElementById('customerName').value = '';
        document.getElementById('number').value = '';
        document.getElementById('pieces').value = '';
        document.getElementById('quickInput').value = '';

        // No reiniciar la lista de n칰meros si ya hay n칰meros copiados
        if (numbers.length === 0) {
            document.getElementById('numbersTableBody').innerHTML = ''; // Limpiar la tabla de n칰meros
            document.getElementById('totalValue').innerText = 'VALOR DE TICKET: 0.00$'; // Reiniciar el total
        }

        // NO incluir estas l칤neas que reinician los selectores:
        // document.getElementById('lotteryType').selectedIndex = 0;
        // document.getElementById('drawTimeSelect').selectedIndex = 0;
        // document.getElementById('drawTimeSelect').disabled = true;
    }

    function updateWinnerDrawTimes() {
        const lotteryType = document.getElementById('filterLottery').value;
        const timeSelect = document.getElementById('filterDrawTime');

        // Reiniciar las opciones
        timeSelect.innerHTML = '<option value="">Todas las Horas</option>';

        if (lotteryType && lotteryType !== 'PANAMA') {
            timeSelect.disabled = false;
            // Agregar las horas espec칤ficas para la loter칤a seleccionada
            if (lotteryTimes[lotteryType]) {
                lotteryTimes[lotteryType].forEach(time => {
                    timeSelect.innerHTML += `<option value="${time}">${time}</option>`;
                });
            }
        } else {
            timeSelect.disabled = true;
        }
    }

    let activeTab = 'tiempos';

    // Funci칩n para cambiar entre las pesta침as de tiempos y billetes
    function switchTab(tabName) {
        activeTab = tabName;

        // Actualizar estilos de las pesta침as
        document.getElementById('tiemposTab').classList.toggle('active', tabName === 'tiempos');
        document.getElementById('billetesTab').classList.toggle('active', tabName === 'billetes');

        // Mostrar/ocultar los contenedores correspondientes
        document.getElementById('tiemposContainer').style.display = tabName === 'tiempos' ? 'block' : 'none';
        document.getElementById('billetesContainer').style.display = tabName === 'billetes' ? 'block' : 'none';

        // Actualizar la visualizaci칩n
        applyFilters();

        // Mostrar u ocultar secci칩n de n칰meros ganadores seg칰n la pesta침a
        if (tabName === 'tiempos') {
            showWinningNumbersSection();
        } else {
            hideWinningNumbersSection();
        }
    }

    // Funci칩n modificada para billetes vendidos
    function updateBilletesSalesTable() {
        const tickets = loadTickets();
        const filterLottery = document.getElementById('filterLotteryType').value;
        const filterTime = document.getElementById('filterDrawTimeSelect').value;
        const filterDate = document.getElementById('salesFilterDate').value;

        // Inicializar un objeto para contar los tiempos vendidos por billete
        const billetesSales = {};

        // Crear objetos Date para el rango del d칤a seleccionado si hay un filtro de fecha
        let selectedDateStart = null;
        let selectedDateEnd = null;

        if (filterDate) {
            selectedDateStart = new Date(filterDate + 'T00:00:00');
            selectedDateEnd = new Date(filterDate + 'T23:59:59');
        }

        // Filtrar y contar los billetes vendidos
        tickets.forEach(ticket => {
            // Convertir la fecha del ticket a un objeto Date para comparaci칩n
            const ticketDate = new Date(ticket.datetime);

            // Verificar si pasa los filtros
            let passesFilters = true;

            // Filtro de loter칤a
            if (filterLottery && ticket.lottery !== filterLottery) {
                passesFilters = false;
            }

            // Filtro de hora de sorteo
            if (filterTime && ticket.drawTime !== filterTime) {
                passesFilters = false;
            }

            // Filtro de fecha - comparar objetos Date para incluir horas
            if (filterDate && (ticketDate < selectedDateStart || ticketDate > selectedDateEnd)) {
                passesFilters = false;
            }

            // Si pasa todos los filtros, contar los billetes vendidos
            if (passesFilters) {
                ticket.numbers.forEach(num => {
                    if (num.number.length === 4) { // Solo contar n칰meros de 4 cifras (billetes)
                        if (!billetesSales[num.number]) {
                            billetesSales[num.number] = 0;
                        }
                        billetesSales[num.number] += parseInt(num.pieces, 10);
                    }
                });
            }
        });

        // Mostrar los resultados en la cuadr칤cula
        const grid = document.getElementById('billetesSalesGrid');
        grid.innerHTML = '';

        // Ordenar los billetes por n칰mero para mostrarlos organizados
        const sortedBilletes = Object.keys(billetesSales).sort();

        // Verificar si no hay billetes para mostrar
        if (sortedBilletes.length === 0) {
            grid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 20px;">No hay billetes vendidos con los filtros seleccionados</div>';
            // CAMBIO: Siempre mostrar el resumen, incluso sin billetes
            displaySalesSummary('billetes');
            return;
        }

        // Recorrer los billetes y mostrarlos en la cuadr칤cula
        sortedBilletes.forEach(billete => {
            if (billetesSales[billete] > 0) {
                const billeteItem = document.createElement('div');
                billeteItem.className = 'billete-item highlight';
                billeteItem.innerHTML = `
                <span>${billete}</span>
                <span>${billetesSales[billete]}</span>
            `;
                grid.appendChild(billeteItem);
            }
        });

        // CAMBIO: Siempre mostrar el resumen
        displaySalesSummary('billetes');
    }


    async function iniciarEscaner() {
        try {
            // Verificar si estamos en Android y si tenemos permisos
            if (typeof Android !== 'undefined') {
                const permissionStatus = Android.getCameraPermissionStatus();
                Android.logFromJS("Estado de permisos de c치mara: " + permissionStatus);

                if (permissionStatus !== 'granted') {
                    showNotification('丘멆잺 Se necesitan permisos de c치mara para escanear c칩digos QR. Por favor, permite el acceso a la c치mara en la configuraci칩n de la app.', 'warning', 8000);
                    return;
                }
            }

            // Configurar el scanner con configuraci칩n optimizada para Android
            const config = {
                fps: 10,
                qrbox: { width: 250, height: 250 },
                aspectRatio: 1.0,
                showTorchButtonIfSupported: true,
                showZoomSliderIfSupported: false, // Desactivar zoom para evitar problemas
                defaultZoomValueIfSupported: 1,
                experimentalFeatures: {
                    useBarCodeDetectorIfSupported: true
                },
                rememberLastUsedCamera: true,
                supportedScanTypes: [Html5QrcodeScanType.SCAN_TYPE_CAMERA]
            };

            html5QrcodeScanner = new Html5QrcodeScanner("reader", config, false);

            html5QrcodeScanner.render(
                (decodedText) => {
                    // 칄xito al escanear
                    if (typeof Android !== 'undefined') {
                        Android.logFromJS("QR escaneado exitosamente: " + decodedText);
                    }

                    const tickets = loadTickets();
                    const ticket = tickets.find(t => t.id === decodedText);

                    if (ticket) {
                        // Limpiar scanner
                        html5QrcodeScanner.clear().then(() => {
                            document.getElementById('scannerContainer').style.display = 'none';
                            verificarTicket(ticket);
                        }).catch(err => {
                            if (typeof Android !== 'undefined') {
                                Android.logFromJS("Error al limpiar scanner: " + err);
                            }
                            document.getElementById('scannerContainer').style.display = 'none';
                            verificarTicket(ticket);
                        });
                    } else {
                        showNotification('仇 Ticket no encontrado en el sistema', 'error');
                    }
                },
                (error) => {
                    // Error de escaneo (normal durante el proceso de escaneo)
                    // Solo logear errores importantes, no "NotFoundException" que es normal
                    if (!error.includes('NotFoundException') && !error.includes('No MultiFormat Readers')) {
                        if (typeof Android !== 'undefined') {
                            Android.logFromJS("Error de scanner (no cr칤tico): " + error);
                        }
                    }
                }
            );

            showNotification('游닝 Scanner iniciado. Apunta la c치mara al c칩digo QR', 'info', 3000);

        } catch (error) {
            if (typeof Android !== 'undefined') {
                Android.logFromJS("Error cr칤tico al iniciar scanner: " + error.message);
            }

            console.error("Error al iniciar scanner:", error);

            if (error.name === 'NotAllowedError') {
                showNotification('仇 Acceso a la c치mara denegado. Por favor, permite el acceso a la c치mara en la configuraci칩n de la app.', 'error', 8000);
            } else if (error.name === 'NotFoundError') {
                showNotification('仇 No se encontr칩 ninguna c치mara en el dispositivo.', 'error');
            } else if (error.name === 'NotSupportedError') {
                showNotification('仇 El escaneo de c칩digos QR no es compatible con este dispositivo.', 'error');
            } else {
                showNotification('仇 Error al iniciar el scanner. Intenta nuevamente.', 'error');
            }
        }
    }
    // Variables para almacenar los l칤mites
    let salesLimits = {
        chances: {}, // L칤mites para n칰meros de 2 cifras
        billetes: {} // L칤mites para n칰meros de 4 cifras
    };

    // Almacenar ventas actuales
    let currentSales = {
        chances: {}, // Ventas actuales para n칰meros de 2 cifras por loter칤a y sorteo
        billetes: {} // Ventas actuales para n칰meros de 4 cifras por loter칤a y sorteo
    };

    // Inicializar l칤mites y ventas actuales desde localStorage
    function initLimitsAndSales() {
        const savedLimits = localStorage.getItem('lotteryLimits');
        if (savedLimits) {
            salesLimits = JSON.parse(savedLimits);
        }

        // Inicializar las ventas actuales basadas en los tickets guardados
        calculateCurrentSales();

        // Mostrar l칤mites actuales si estamos en la p치gina de configuraci칩n
        if (document.getElementById('configPage').style.display !== 'none') {
            displayCurrentLimits('chances');
            displayCurrentLimits('billetes');
        }
    }

    // Calcular ventas actuales basadas en los tickets guardados
    function calculateCurrentSales() {
        currentSales = {
            chances: {},
            billetes: {}
        };

        const tickets = loadTickets();
        console.log("Total de tickets cargados:", tickets.length);

        // Obtener la fecha actual en formato local YYYY-MM-DD
        const today = new Date();
        const todayYear = today.getFullYear();
        const todayMonth = String(today.getMonth() + 1).padStart(2, '0');
        const todayDay = String(today.getDate()).padStart(2, '0');
        const todayString = `${todayYear}-${todayMonth}-${todayDay}`;

        console.log("Fecha actual:", todayString);

        // Solo contar tickets no pagados (que a칰n est치n activos) Y que sean del d칤a de hoy
        const activeTickets = tickets.filter(ticket => {
            const ticketDate = new Date(ticket.datetime);
            const ticketYear = ticketDate.getFullYear();
            const ticketMonth = String(ticketDate.getMonth() + 1).padStart(2, '0');
            const ticketDay = String(ticketDate.getDate()).padStart(2, '0');
            const ticketDateString = `${ticketYear}-${ticketMonth}-${ticketDay}`;

            const isToday = ticketDateString === todayString;
            const isNotPaid = !ticket.paid;

            console.log(`Ticket ${ticket.id}: fecha=${ticketDateString}, es hoy=${isToday}, no pagado=${isNotPaid}`);

            return isNotPaid && isToday;
        });

        console.log(`Tickets activos para hoy (${todayString}):`, activeTickets.length);
        console.log("Tickets que se contar치n para l칤mites:", activeTickets);

        activeTickets.forEach(ticket => {
            const lottery = ticket.lottery;
            const drawTime = ticket.drawTime || 'default';
            const key = `${lottery}_${drawTime}`;

            ticket.numbers.forEach(num => {
                const number = num.number;
                const pieces = parseInt(num.pieces, 10);

                if (number.length === 2) { // Chances (2 cifras)
                    if (!currentSales.chances[key]) {
                        currentSales.chances[key] = {};
                    }
                    if (!currentSales.chances[key][number]) {
                        currentSales.chances[key][number] = 0;
                    }
                    currentSales.chances[key][number] += pieces;
                    console.log(`Sumando ${pieces} tiempos para el chance ${number}, total: ${currentSales.chances[key][number]}`);
                } else if (number.length === 4) { // Billetes (4 cifras)
                    if (!currentSales.billetes[key]) {
                        currentSales.billetes[key] = {};
                    }
                    if (!currentSales.billetes[key][number]) {
                        currentSales.billetes[key][number] = 0;
                    }
                    currentSales.billetes[key][number] += pieces;
                    console.log(`Sumando ${pieces} tiempos para el billete ${number}, total: ${currentSales.billetes[key][number]}`);
                }
            });
        });

        console.log("Ventas actuales calculadas:", currentSales);
    }

    // Funci칩n para reiniciar las ventas actuales (칰til para depuraci칩n)
    function resetCurrentSales() {
        currentSales = {
            chances: {},
            billetes: {}
        };
        console.log("Ventas actuales reiniciadas manualmente");
        showNotification("Ventas actuales reiniciadas manualmente");
    }

    // Mostrar la p치gina de configuraci칩n
    function showConfigPage() {
        closeMenu();
        document.getElementById('mainPage').style.display = 'none';
        document.getElementById('salesPage').style.display = 'none';
        document.getElementById('numberSalesPage').style.display = 'none';
        document.getElementById('verifyWinnersPage').style.display = 'none';
        document.getElementById('configPage').style.display = 'block';

        // Actualizar los selectores de hora para los l칤mites
        updateLimitDrawTimes();
        updateLimitBilleteDrawTimes();

        // Mostrar l칤mites actuales
        displayCurrentLimits('chances');
        displayCurrentLimits('billetes');
    }

    // Cambiar entre pesta침as de l칤mites
    function switchLimitTab(tab) {
        // Actualizar estilos de las pesta침as
        document.getElementById('chancesLimitTab').classList.toggle('active', tab === 'chances');
        document.getElementById('billetesLimitTab').classList.toggle('active', tab === 'billetes');

        // Mostrar/ocultar los contenedores correspondientes
        document.getElementById('chancesLimitContainer').style.display = tab === 'chances' ? 'block' : 'none';
        document.getElementById('billetesLimitContainer').style.display = tab === 'billetes' ? 'block' : 'none';

        // Mostrar l칤mites actuales
        displayCurrentLimits(tab);
    }

    // Actualizar selectores de hora para l칤mites (chances)
    function updateLimitDrawTimes() {
        const lotteryType = document.getElementById('limitLotteryType').value;
        const timeSelect = document.getElementById('limitDrawTimeSelect');
        timeSelect.innerHTML = '<option value="">Seleccione hora de sorteo</option>';

        const baseLottery = getBaseLottery(lotteryType);

        if (lotteryType && baseLottery !== 'PANAMA') {
            timeSelect.disabled = false;
            lotteryTimes[lotteryType].forEach(time => {
                timeSelect.innerHTML += `<option value="${time}">${time}</option>`;
            });
        } else {
            timeSelect.disabled = true;
        }
    }

    // Actualizar selectores de hora para l칤mites (billetes)
    function updateLimitBilleteDrawTimes() {
        const lotteryType = document.getElementById('limitBilleteLotteryType').value;
        const timeSelect = document.getElementById('limitBilleteDrawTimeSelect');
        timeSelect.innerHTML = '<option value="">Seleccione hora de sorteo</option>';

        const baseLottery = getBaseLottery(lotteryType);

        if (lotteryType && baseLottery !== 'PANAMA') {
            timeSelect.disabled = false;
            lotteryTimes[lotteryType].forEach(time => {
                timeSelect.innerHTML += `<option value="${time}">${time}</option>`;
            });
        } else {
            timeSelect.disabled = true;
        }
    }
    // Establecer l칤mite global para todos los n칰meros
    function setGlobalLimit(type) {
        let lottery, drawTime, globalLimit, key;

        if (type === 'chances') {
            lottery = document.getElementById('limitLotteryType').value;
            drawTime = document.getElementById('limitDrawTimeSelect').value || 'default';
            globalLimit = parseInt(document.getElementById('globalChancesLimit').value, 10);
        } else if (type === 'billetes') {
            lottery = document.getElementById('limitBilleteLotteryType').value;
            drawTime = document.getElementById('limitBilleteDrawTimeSelect').value || 'default';
            globalLimit = parseInt(document.getElementById('globalBilletesLimit').value, 10);
        }

        if (!lottery) {
            showNotification('Por favor seleccione una loter칤a');
            return;
        }

        if (isNaN(globalLimit) || globalLimit < 0) {
            showNotification('Por favor ingrese un l칤mite v치lido (n칰mero positivo)');
            return;
        }

        key = `${lottery}_${drawTime}`;

        // Inicializar el objeto de l칤mites si no existe
        if (type === 'chances') {
            if (!salesLimits.chances[key]) {
                salesLimits.chances[key] = {
                    globalLimit: 0,
                    numbers: {}
                };
            }
            salesLimits.chances[key].globalLimit = globalLimit;
        } else if (type === 'billetes') {
            if (!salesLimits.billetes[key]) {
                salesLimits.billetes[key] = {
                    globalLimit: 0,
                    numbers: {}
                };
            }
            salesLimits.billetes[key].globalLimit = globalLimit;
        }

        // Guardar en localStorage
        localStorage.setItem('lotteryLimits', JSON.stringify(salesLimits));

        // Actualizar visualizaci칩n de l칤mites actuales
        displayCurrentLimits(type);

        const typeText = type === 'chances' ? 'chances' : 'billetes';
        showNotification(`L칤mite global de ${globalLimit} tiempos establecido para cada ${typeText} de ${lottery} - ${drawTime || 'Todos los sorteos'}`);
    }

    // Establecer l칤mite individual para un n칰mero espec칤fico
    function setIndividualLimit(type) {
        let lottery, drawTime, number, limit, key;

        if (type === 'chances') {
            lottery = document.getElementById('limitLotteryType').value;
            drawTime = document.getElementById('limitDrawTimeSelect').value || 'default';
            number = document.getElementById('chanceNumber').value.padStart(2, '0');
            limit = parseInt(document.getElementById('chanceLimit').value, 10);

            if (!lottery) {
                showNotification('Por favor seleccione una loter칤a');
                return;
            }

            if (!number || number.length !== 2 || isNaN(parseInt(number, 10))) {
                showNotification('Por favor ingrese un n칰mero v치lido de 2 cifras (00-99)');
                return;
            }

        } else if (type === 'billetes') {
            lottery = document.getElementById('limitBilleteLotteryType').value;
            drawTime = document.getElementById('limitBilleteDrawTimeSelect').value || 'default';
            number = document.getElementById('billeteNumber').value.padStart(4, '0');
            limit = parseInt(document.getElementById('billeteLimit').value, 10);

            if (!lottery) {
                showNotification('Por favor seleccione una loter칤a');
                return;
            }

            if (!number || number.length !== 4 || isNaN(parseInt(number, 10))) {
                showNotification('Por favor ingrese un n칰mero v치lido de 4 cifras (0000-9999)');
                return;
            }
        }

        if (isNaN(limit) || limit < 0) {
            showNotification('Por favor ingrese un l칤mite v치lido (n칰mero positivo)');
            return;
        }

        key = `${lottery}_${drawTime}`;

        // Inicializar el objeto de l칤mites si no existe
        if (type === 'chances') {
            if (!salesLimits.chances[key]) {
                salesLimits.chances[key] = {
                    globalLimit: 0,
                    numbers: {}
                };
            }
            // Asegurarse de que exista el objeto numbers
            if (!salesLimits.chances[key].numbers) {
                salesLimits.chances[key].numbers = {};
            }
            salesLimits.chances[key].numbers[number] = limit;
        } else if (type === 'billetes') {
            if (!salesLimits.billetes[key]) {
                salesLimits.billetes[key] = {
                    globalLimit: 0,
                    numbers: {}
                };
            }
            // Asegurarse de que exista el objeto numbers
            if (!salesLimits.billetes[key].numbers) {
                salesLimits.billetes[key].numbers = {};
            }
            salesLimits.billetes[key].numbers[number] = limit;
        }

        // Guardar en localStorage
        localStorage.setItem('lotteryLimits', JSON.stringify(salesLimits));

        // Actualizar visualizaci칩n de l칤mites actuales
        displayCurrentLimits(type);

        // Limpiar los campos despu칠s de establecer el l칤mite
        if (type === 'chances') {
            document.getElementById('chanceNumber').value = '';
            document.getElementById('chanceLimit').value = '';
        } else {
            document.getElementById('billeteNumber').value = '';
            document.getElementById('billeteLimit').value = '';
        }

        showNotification(`L칤mite de ${limit} tiempos establecido para el n칰mero ${number} - ${lottery} - ${drawTime || 'Todos los sorteos'}`);
    }

    // Mostrar l칤mites actuales
    function displayCurrentLimits(type) {
        const container = document.getElementById(type === 'chances' ? 'currentChancesLimits' : 'currentBilletesLimits');
        container.innerHTML = '';

        // Obtener la categor칤a correcta de l칤mites
        const limits = type === 'chances' ? salesLimits.chances : salesLimits.billetes;

        // Si no hay l칤mites configurados
        if (!limits || Object.keys(limits).length === 0) {
            container.innerHTML = '<p>No hay l칤mites configurados actualmente.</p>';
            return;
        }

        // Generar contenido HTML para mostrar los l칤mites
        let html = '';

        for (const key in limits) {
            const [lottery, drawTime] = key.split('_');
            html += `<div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee;">`;
            html += `<h5>${lottery} - ${drawTime === 'default' ? 'Todos los sorteos' : drawTime}</h5>`;

            // Mostrar l칤mite global
            if (limits[key].globalLimit) {
                html += `<p><strong>L칤mite Global para cada n칰mero:</strong> ${limits[key].globalLimit} tiempos</p>`;
            }

            // Mostrar l칤mites individuales
            const numbers = limits[key].numbers || {};
            if (Object.keys(numbers).length > 0) {
                html += `<p><strong>L칤mites Individuales:</strong></p>`;
                html += `<div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px;">`;

                for (const number in numbers) {
                    html += `<div style="border: 1px solid #ddd; padding: 5px; text-align: center;">
                        ${number}: ${numbers[number]}
                    </div>`;
                }

                html += `</div>`;
            } else {
                html += `<p>No hay l칤mites individuales configurados.</p>`;
            }

            // Bot칩n para eliminar configuraci칩n de esta loter칤a y sorteo
            html += `<button onclick="removeLimitConfig('${type}', '${key}')"
                      style="margin-top: 10px; background-color: #ff4d4d; color: white;">
                      Eliminar Configuraci칩n
                    </button>`;

            html += `</div>`;
        }

        container.innerHTML = html;
    }
    // Eliminar configuraci칩n de l칤mites para una loter칤a y sorteo espec칤ficos
    function removeLimitConfig(type, key) {
        if (confirm('쮼st치 seguro de eliminar esta configuraci칩n de l칤mites?')) {
            if (type === 'chances') {
                delete salesLimits.chances[key];
            } else {
                delete salesLimits.billetes[key];
            }

            // Guardar en localStorage
            localStorage.setItem('lotteryLimits', JSON.stringify(salesLimits));

            // Actualizar visualizaci칩n
            displayCurrentLimits(type);
        }
    }

    // Guardar configuraci칩n y volver a la p치gina principal
    function saveConfigAndReturn() {
        // La configuraci칩n ya se ha guardado en cada cambio
        // Ocultar expl칤citamente la p치gina de configuraci칩n
        document.getElementById('configPage').style.display = 'none';

        // Llamar a la funci칩n para mostrar la p치gina principal
        showMainPage();
    }

    // Verificar l칤mites antes de agregar un n칰mero
    function checkLimits(number, pieces) {
        const lotteryType = document.getElementById('lotteryType').value;
        const drawTime = document.getElementById('drawTimeSelect').value || 'default';
        const key = `${lotteryType}_${drawTime}`;

        // Determinar si es un chance (2 cifras) o un billete (4 cifras)
        const isChance = number.length === 2;
        const type = isChance ? 'chances' : 'billetes';
        const limits = isChance ? salesLimits.chances[key] : salesLimits.billetes[key];

        // Si no hay l칤mites configurados para esta loter칤a y sorteo, permitir la venta
        if (!limits) {
            return true;
        }

        // Obtener ventas actuales
        if (!currentSales[type][key]) {
            currentSales[type][key] = {};
        }
        const currentNumberSales = currentSales[type][key][number] || 0;

        // Verificar l칤mite individual para este n칰mero espec칤fico
        if (limits.numbers && limits.numbers[number] !== undefined) {
            // Tenemos un l칤mite espec칤fico para este n칰mero
            const limit = limits.numbers[number];
            if (currentNumberSales + pieces > limit) {
                showNotification(`춰L칤mite excedido! Solo puede vender ${limit} tiempos del n칰mero ${number} y ya ha vendido ${currentNumberSales}.`);
                return false;
            }
        } else if (limits.globalLimit) {
            // No hay l칤mite espec칤fico, pero hay un l칤mite global para todos los n칰meros de este tipo
            // Este l칤mite global se aplica a cada n칰mero individualmente
            if (currentNumberSales + pieces > limits.globalLimit) {
                showNotification(`춰L칤mite excedido! Solo puede vender ${limits.globalLimit} tiempos del n칰mero ${number} y ya ha vendido ${currentNumberSales}.`);
                return false;
            }
        }

        return true;
    }

    function validarHorarioVenta() {
        const lotteryType = document.getElementById('lotteryType').value;
        const drawTime = document.getElementById('drawTimeSelect').value;

        // Si no hay hora de sorteo seleccionada, no permitir
        if (!drawTime) return false;

        const ahora = new Date();
        const horaActual = ahora.getHours();
        const minutoActual = ahora.getMinutes();

        // Convertir hora del sorteo (ej: "3:00 PM" -> 15:00)
        let [tiempo, periodo] = drawTime.split(' ');
        let [hora, minutos] = tiempo.split(':').map(Number);

        // Convertir a formato 24 horas
        if (periodo === 'PM' && hora !== 12) {
            hora += 12;
        } else if (periodo === 'AM' && hora === 12) {
            hora = 0;
        }

        // Calcular tiempo actual y tiempo de sorteo en minutos
        const horaSorteoEnMinutos = hora * 60 + minutos;
        const horaActualEnMinutos = horaActual * 60 + minutoActual;

        // Calcular diferencia (positiva = sorteo en el futuro, negativa = sorteo ya pas칩)
        const diferencia = horaSorteoEnMinutos - horaActualEnMinutos;

        // Si faltan 1 minutos o menos para el sorteo, no permitir venta
        if (diferencia <= 1 && diferencia >= 0) {
            return false;
        }

        // Si el sorteo ya pas칩, permitir solo despu칠s de 20 minutos
        if (diferencia < 0) {
            const minutosPasados = Math.abs(diferencia);
            return minutosPasados > 20;
        }

        // Si faltan m치s de 5 minutos, permitir venta
        return true;
    }
    function validarHorarioEliminacion(lotteryType = null, drawTime = null) {
        // Si no se pasan par치metros, usar los valores actuales de los selectores
        if (!lotteryType) {
            lotteryType = document.getElementById('lotteryType').value;
        }
        if (!drawTime) {
            drawTime = document.getElementById('drawTimeSelect').value;
        }

        // Si no hay hora de sorteo, permitir eliminaci칩n
        if (!drawTime) {
            return { allowed: true };
        }

        // Para PANAMA y REVENTADO_PANAMA, usar la hora por defecto
        if (lotteryType === 'PANAMA' || lotteryType === 'REVENTADO_PANAMA') {
            drawTime = '3:00 PM';
        }

        const ahora = new Date();
        const horaActual = ahora.getHours();
        const minutoActual = ahora.getMinutes();

        // Convertir hora del sorteo (ej: "3:00 PM" -> 15:00)
        let [tiempo, periodo] = drawTime.split(' ');
        let [hora, minutos] = tiempo.split(':').map(Number);

        // Convertir a formato 24 horas
        if (periodo === 'PM' && hora !== 12) {
            hora += 12;
        } else if (periodo === 'AM' && hora === 12) {
            hora = 0;
        }

        // Calcular tiempo actual y tiempo de sorteo en minutos
        const horaSorteoEnMinutos = hora * 60 + minutos;
        const horaActualEnMinutos = horaActual * 60 + minutoActual;

        // Calcular diferencia (positiva = sorteo en el futuro, negativa = sorteo ya pas칩)
        const diferencia = horaSorteoEnMinutos - horaActualEnMinutos;

        // Si faltan 1 minutos o menos para el sorteo, no permitir eliminaci칩n
        if (diferencia <= 1 && diferencia >= 0) {
            const minutosRestantes = Math.max(0, diferencia);
            return {
                allowed: false,
                reason: 'pre_sorteo',
                drawTime: drawTime,
                minutesLeft: minutosRestantes
            };
        }

        // Si el sorteo ya pas칩, permitir eliminaci칩n solo despu칠s de 20 minutos
        if (diferencia < 0) {
            const minutosPasados = Math.abs(diferencia);
            if (minutosPasados <= 10) {
                const minutosRestantes = 10 - minutosPasados;
                return {
                    allowed: false,
                    reason: 'post_sorteo',
                    drawTime: drawTime,
                    minutesLeft: minutosRestantes
                };
            }
        }

        // Si faltan m치s de 1 minuto, permitir eliminaci칩n
        return { allowed: true };
    }
    // Funci칩n para generar mensaje espec칤fico de eliminaci칩n
    function getEliminationBlockMessage(validationResult) {
        const { reason, drawTime, minutesLeft } = validationResult;

        if (reason === 'pre_sorteo') {
            if (minutesLeft === 0) {
                return `游뛂 ELIMINACI칍N BLOQUEADA\n\nEl sorteo de las ${drawTime} est치 a punto de iniciar.\n\nDebes esperar hasta 20 minutos despu칠s del sorteo para eliminar tickets.`;
            } else {
                return `游뛂 ELIMINACI칍N BLOQUEADA\n\nFalta ${Math.ceil(minutesLeft)} minuto(s) para el sorteo de las ${drawTime}.\n\nLa eliminaci칩n se bloquea 1 minuto antes del sorteo.`;
            }
        } else if (reason === 'post_sorteo') {
            return `游뛂 ELIMINACI칍N BLOQUEADA\n\nEl sorteo de las ${drawTime} ya ocurri칩.\n\nDebes esperar ${Math.ceil(minutesLeft)} minuto(s) m치s para eliminar tickets.\n\n(Se permite eliminar 20 minutos despu칠s del sorteo)`;
        }

        return 'No se puede eliminar el ticket en este momento.';
    }

    // Establecer l칤mite global para billetes (4 cifras)
    function setGlobalBilletesLimit() {
        const lottery = document.getElementById('limitBilleteLotteryType').value;
        const drawTime = document.getElementById('limitBilleteDrawTimeSelect').value || 'default';
        const globalLimit = parseInt(document.getElementById('globalBilletesLimit').value, 10);

        if (!lottery) {
            showNotification('Por favor seleccione una loter칤a');
            return;
        }

        if (isNaN(globalLimit) || globalLimit < 0) {
            showNotification('Por favor ingrese un l칤mite v치lido (n칰mero positivo)');
            return;
        }

        const key = `${lottery}_${drawTime}`;

        // Inicializar el objeto de l칤mites si no existe
        if (!salesLimits.billetes[key]) {
            salesLimits.billetes[key] = {
                globalLimit: 0
            };
        }

        // Establecer el l칤mite global
        salesLimits.billetes[key].globalLimit = globalLimit;

        // Guardar en localStorage
        localStorage.setItem('lotteryLimits', JSON.stringify(salesLimits));

        // Actualizar visualizaci칩n de l칤mites actuales
        displayCurrentLimits('billetes');

        showNotification(`L칤mite global de ${globalLimit} tiempos establecido para billetes de ${lottery} - ${drawTime || 'Todos los sorteos'}`);
    }

    // Funci칩n para calcular totales de ventas
    function calculateSalesTotals(type) {
        const tickets = loadTickets();
        const filterLottery = document.getElementById('filterLotteryType').value;
        const filterTime = document.getElementById('filterDrawTimeSelect').value;
        const filterDate = document.getElementById('salesFilterDate').value;

        let totalTiempos = 0;
        let totalColones = 0;

        let selectedDateStart = null;
        let selectedDateEnd = null;

        if (filterDate) {
            selectedDateStart = new Date(filterDate + 'T00:00:00');
            selectedDateEnd = new Date(filterDate + 'T23:59:59');
        }

        tickets.forEach(ticket => {
            const ticketDate = new Date(ticket.datetime);
            let passesFilters = true;

            if (filterLottery && ticket.lottery !== filterLottery) {
                passesFilters = false;
            }

            if (filterTime && ticket.drawTime !== filterTime) {
                passesFilters = false;
            }

            if (filterDate && (ticketDate < selectedDateStart || ticketDate > selectedDateEnd)) {
                passesFilters = false;
            }

            if (passesFilters) {
                ticket.numbers.forEach(num => {
                    if ((type === 'tiempos' && num.number.length === 2) ||
                        (type === 'billetes' && num.number.length === 4)) {

                        const pieces = parseFloat(num.pieces);
                        const subTotal = parseFloat(num.subTotal);

                        totalTiempos += pieces;
                        totalColones += subTotal;
                    }
                });
            }
        });

        return { totalTiempos, totalColones };
    }

    function displaySalesSummary(type) {
        const totals = calculateSalesTotals(type);
        const summaryBox = document.getElementById('salesSummaryBox');

        summaryBox.style.display = 'block';

        const totalTiemposDisplay = totals.totalTiempos % 1 !== 0 ?
            totals.totalTiempos.toFixed(1) :
            totals.totalTiempos.toString();

        document.getElementById('totalTiempos').textContent = totalTiemposDisplay;
        document.getElementById('totalColones').textContent = '$' + totals.totalColones.toFixed(2);

        const title = type === 'tiempos' ? 'Resumen de Chances' : 'Resumen de Billetes';
        summaryBox.querySelector('h3').textContent = title;

        addPercentageBreakdown(summaryBox, totals.totalColones);

        // Solo mostrar n칰meros ganadores para tiempos, pero fuera de la tarjeta
        if (type === 'tiempos') {
            showWinningNumbersSection();
        } else {
            hideWinningNumbersSection();
        }
    }

    // Funci칩n para mostrar secci칩n de n칰meros ganadores independiente
    function showWinningNumbersSection() {
        let winningSection = document.getElementById('independentWinningSection');

        if (!winningSection) {
            winningSection = document.createElement('div');
            winningSection.id = 'independentWinningSection';
            winningSection.className = 'winning-numbers-independent';

            const screenshotButton = document.getElementById('screenshotButton');
            if (screenshotButton) {
                screenshotButton.parentNode.insertBefore(winningSection, screenshotButton);
            } else {
                const tiemposContainer = document.getElementById('tiemposContainer');
                if (tiemposContainer) {
                    tiemposContainer.appendChild(winningSection);
                }
            }
        }

        // Verificar si la loter칤a seleccionada es REVENTADO
        const filterLottery = document.getElementById('filterLotteryType').value;
        const isReventadoLottery = filterLottery && filterLottery.startsWith('REVENTADO_');

        if (isReventadoLottery) {
            // Interfaz para loter칤as REVENTADO
            winningSection.innerHTML = `
        <div style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h4 style="margin: 0 0 15px 0; color: #333;">N칰mero Ganador - ${getDisplayName(filterLottery)}</h4>
            <div style="display: flex; justify-content: center; margin-bottom: 15px;">
                <div style="text-align: center;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #666;">N칰mero Ganador</label>
                    <input type="text" id="reventadoPrizeInput" maxlength="2"
                           style="width: 80px; padding: 12px; text-align: center; font-size: 18px; border: 2px solid #dc3545; border-radius: 4px;"
                           placeholder="00" inputmode="numeric" pattern="[0-9]*">
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button onclick="clearReventadoPrizeInput()"
                        style="padding: 10px; background-color: #6c757d; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer;">
                    Limpiar
                </button>
                <button onclick="calculateReventadoWinnings()"
                        style="padding: 10px; background-color: #dc3545; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer;">
                    Calcular REVENTADO
                </button>
            </div>
            <div id="reventadoWinningsResult" style="margin-top: 20px;"></div>
        </div>
    `;
        } else {
            // Interfaz normal para loter칤as regulares
            winningSection.innerHTML = `
            <div style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h4 style="margin: 0 0 15px 0; color: #333;">N칰meros Ganadores</h4>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 15px;">
                    <div style="text-align: center;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #666;">1er Premio</label>
                        <input type="text" id="firstPrizeInput" maxlength="2"
                               style="width: 60px; padding: 8px; text-align: center; font-size: 16px; border: 2px solid #007bff; border-radius: 4px;"
                               placeholder="00" inputmode="numeric" pattern="[0-9]*">
                    </div>
                    <div style="text-align: center;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #666;">2do Premio</label>
                        <input type="text" id="secondPrizeInput" maxlength="2"
                               style="width: 60px; padding: 8px; text-align: center; font-size: 16px; border: 2px solid #28a745; border-radius: 4px;"
                               placeholder="00" inputmode="numeric" pattern="[0-9]*">
                    </div>
                    <div style="text-align: center;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #666;">3er Premio</label>
                        <input type="text" id="thirdPrizeInput" maxlength="2"
                               style="width: 60px; padding: 8px; text-align: center; font-size: 16px; border: 2px solid #ffc107; border-radius: 4px;"
                               placeholder="00" inputmode="numeric" pattern="[0-9]*">
                    </div>
                </div>
               <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
    <button onclick="clearPrizeInputs()"
            style="padding: 10px; background-color: #dc3545; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer;">
        Borrar CF
    </button>
    <button onclick="calculateWinnings()"
            style="padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer;">
        Verificar
    </button>
</div>
                <div id="winningsResult" style="margin-top: 20px;"></div>
            </div>
        `;
        }

        addNumericInputEvents();

        setTimeout(() => {
            loadAndDisplayWinningNumbers();
        }, 100);

        winningSection.style.display = 'block';
    }

    // Funci칩n para ocultar la secci칩n
    function hideWinningNumbersSection() {
        const winningSection = document.getElementById('independentWinningSection');
        if (winningSection) {
            winningSection.style.display = 'none';
        }
    }

    // Funci칩n para agregar eventos de teclado num칠rico a los inputs
    // Funci칩n para agregar eventos de teclado num칠rico a los inputs
    function addNumericInputEvents() {
        const inputs = ['firstPrizeInput', 'secondPrizeInput', 'thirdPrizeInput'];

        inputs.forEach(inputId => {
            const input = document.getElementById(inputId);
            if (input) {
                // Permitir solo n칰meros
                input.addEventListener('input', function (e) {
                    // Remover todo lo que no sea n칰mero
                    let value = this.value.replace(/[^0-9]/g, '');

                    // Limitar a 2 d칤gitos m치ximo
                    if (value.length > 2) {
                        value = value.slice(0, 2);
                    }

                    this.value = value;
                });

                // Prevenir entrada de caracteres no num칠ricos
                input.addEventListener('keypress', function (e) {
                    if (!/[0-9]/.test(e.key) && !['Backspace', 'Delete', 'Tab', 'Enter', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                        e.preventDefault();
                    }
                });

                // Solo formatear con cero al inicio cuando pierda el foco Y tenga un solo d칤gito
                input.addEventListener('blur', function () {
                    if (this.value.length === 1) {
                        this.value = '0' + this.value;
                    }
                    // No hacer nada si est치 vac칤o o ya tiene 2 d칤gitos
                });

                // Seleccionar todo el texto al hacer foco
                input.addEventListener('focus', function () {
                    this.select();
                });
            }
        });
    }

    // Funci칩n para generar clave 칰nica para los n칰meros ganadores
    function getWinningNumbersKey() {
        const filterLottery = document.getElementById('filterLotteryType').value || 'ALL';
        const filterTime = document.getElementById('filterDrawTimeSelect').value || 'ALL';
        const filterDate = document.getElementById('salesFilterDate').value || 'ALL';

        return `winningNumbers_${filterLottery}_${filterTime}_${filterDate}`;
    }

    // Funci칩n para guardar n칰meros ganadores
    function saveWinningNumbers(firstPrize, secondPrize, thirdPrize, winningsData) {
        const key = getWinningNumbersKey();
        const data = {
            firstPrize: firstPrize,
            secondPrize: secondPrize,
            thirdPrize: thirdPrize,
            winningsData: winningsData,
            timestamp: new Date().toISOString()
        };

        localStorage.setItem(key, JSON.stringify(data));
    }

    // Funci칩n para cargar n칰meros ganadores
    function loadWinningNumbers() {
        const key = getWinningNumbersKey();
        const savedData = localStorage.getItem(key);

        if (savedData) {
            try {
                return JSON.parse(savedData);
            } catch (error) {
                console.error('Error al cargar n칰meros ganadores:', error);
                return null;
            }
        }

        return null;
    }

    // Funci칩n para cargar n칰meros ganadores en los inputs y mostrar resultado
    function loadAndDisplayWinningNumbers() {
        const filterLottery = document.getElementById('filterLotteryType').value;
        const isReventadoLottery = filterLottery && filterLottery.startsWith('REVENTADO_');

        if (isReventadoLottery) {
            loadReventadoWinnings();
        } else {
            const savedData = loadWinningNumbers();

            if (savedData) {
                document.getElementById('firstPrizeInput').value = savedData.firstPrize;
                document.getElementById('secondPrizeInput').value = savedData.secondPrize;
                document.getElementById('thirdPrizeInput').value = savedData.thirdPrize;
                document.getElementById('winningsResult').innerHTML = savedData.winningsData;
                showNotification('N칰meros ganadores cargados autom치ticamente', 'info', 2000);
            }
        }
    }

    // Funci칩n para agregar secci칩n de n칰meros ganadores
    function addWinningNumbersSection(summaryBox, totalColones) {
        // Remover secci칩n previa si existe
        const existingSection = summaryBox.querySelector('.winning-numbers-section');
        if (existingSection) {
            existingSection.remove();
        }

        const winningSection = document.createElement('div');
        winningSection.className = 'winning-numbers-section';
        winningSection.innerHTML = `
        <div style="border-top: 1px solid #ddd; padding-top: 15px; margin-top: 15px;">
            <h4 style="margin-bottom: 10px;">N칰meros Ganadores</h4>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 10px;">
                <div>
                    <label>1er Premio:</label>
                    <input type="text" id="firstPrizeInput" maxlength="2" style="width: 100%; padding: 5px;" placeholder="00">
                </div>
                <div>
                    <label>2do Premio:</label>
                    <input type="text" id="secondPrizeInput" maxlength="2" style="width: 100%; padding: 5px;" placeholder="00">
                </div>
                <div>
                    <label>3er Premio:</label>
                    <input type="text" id="thirdPrizeInput" maxlength="2" style="width: 100%; padding: 5px;" placeholder="00">
                </div>
            </div>
            <button onclick="calculateWinnings()" style="width: 100%; padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 4px;">
                Calcular Ganancias
            </button>
            <div id="winningsResult" style="margin-top: 15px;"></div>
        </div>
    `;

        // Insertar antes del breakdown de porcentajes
        const percentageBreakdown = summaryBox.querySelector('.percentage-breakdown');
        if (percentageBreakdown) {
            summaryBox.insertBefore(winningSection, percentageBreakdown);
        } else {
            summaryBox.appendChild(winningSection);
        }
    }

    // Funci칩n para calcular ganancias de n칰meros ganadores
    // Funci칩n para calcular ganancias de n칰meros ganadores
    function calculateWinnings() {
        const firstPrize = document.getElementById('firstPrizeInput').value.padStart(2, '0');
        const secondPrize = document.getElementById('secondPrizeInput').value.padStart(2, '0');
        const thirdPrize = document.getElementById('thirdPrizeInput').value.padStart(2, '0');

        if (!firstPrize || !secondPrize || !thirdPrize) {
            showNotification('Por favor complete todos los n칰meros ganadores', 'warning');
            return;
        }



        // Obtener datos filtrados actuales
        const tickets = loadTickets();
        const filterLottery = document.getElementById('filterLotteryType').value;
        const filterTime = document.getElementById('filterDrawTimeSelect').value;
        const filterDate = document.getElementById('salesFilterDate').value;

        // Objeto para contar tiempos vendidos
        const numberSales = {};

        // Aplicar mismos filtros que en updateNumberSalesTable()
        let selectedDateStart = null;
        let selectedDateEnd = null;

        if (filterDate) {
            selectedDateStart = new Date(filterDate + 'T00:00:00');
            selectedDateEnd = new Date(filterDate + 'T23:59:59');
        }

        tickets.forEach(ticket => {
            const ticketDate = new Date(ticket.datetime);
            let passesFilters = true;

            if (filterLottery && ticket.lottery !== filterLottery) passesFilters = false;
            if (filterTime && ticket.drawTime !== filterTime) passesFilters = false;
            if (filterDate && (ticketDate < selectedDateStart || ticketDate > selectedDateEnd)) passesFilters = false;

            if (passesFilters) {
                ticket.numbers.forEach(num => {
                    if (num.number.length === 2) {
                        if (!numberSales[num.number]) {
                            numberSales[num.number] = 0;
                        }
                        numberSales[num.number] += parseInt(num.pieces, 10);
                    }
                });
            }
        });

        // Calcular premios
        const winners = [];
        let totalPrizes = 0;

        if (numberSales[firstPrize]) {
            const amount = numberSales[firstPrize] * 11;
            winners.push({ number: firstPrize, times: numberSales[firstPrize], prize: '1er Premio', amount: amount });
            totalPrizes += amount;
        }

        if (numberSales[secondPrize]) {
            const amount = numberSales[secondPrize] * 3;
            winners.push({ number: secondPrize, times: numberSales[secondPrize], prize: '2do Premio', amount: amount });
            totalPrizes += amount;
        }

        if (numberSales[thirdPrize]) {
            const amount = numberSales[thirdPrize] * 2;
            winners.push({ number: thirdPrize, times: numberSales[thirdPrize], prize: '3er Premio', amount: amount });
            totalPrizes += amount;
        }

        // Obtener monto del administrador
        const totals = calculateSalesTotals('tiempos');
        const adminAmount = (totals.totalColones * (100 - sellerPercentage)) / 100;
        const netResult = adminAmount - totalPrizes;

        // Mostrar resultados
        const winningsHTML = generateWinningsHTML(winners, totalPrizes, adminAmount, netResult);
        document.getElementById('winningsResult').innerHTML = winningsHTML;

        // Guardar datos
        saveWinningNumbers(firstPrize, secondPrize, thirdPrize, winningsHTML);

        showNotification('Ganancias calculadas y guardadas', 'success');
    }

    // Funci칩n para calcular ganancias de loter칤a REVENTADO
    function calculateReventadoWinnings() {
        const reventadoPrize = document.getElementById('reventadoPrizeInput').value.padStart(2, '0');

        if (!reventadoPrize) {
            showNotification('Por favor complete el n칰mero ganador', 'warning');
            return;
        }

        // Obtener datos filtrados actuales
        const tickets = loadTickets();
        const filterLottery = document.getElementById('filterLotteryType').value;
        const filterTime = document.getElementById('filterDrawTimeSelect').value;
        const filterDate = document.getElementById('salesFilterDate').value;

        // Objeto para contar tiempos vendidos
        const numberSales = {};

        // Aplicar mismos filtros
        let selectedDateStart = null;
        let selectedDateEnd = null;

        if (filterDate) {
            selectedDateStart = new Date(filterDate + 'T00:00:00');
            selectedDateEnd = new Date(filterDate + 'T23:59:59');
        }

        tickets.forEach(ticket => {
            const ticketDate = new Date(ticket.datetime);
            let passesFilters = true;

            if (filterLottery && ticket.lottery !== filterLottery) passesFilters = false;
            if (filterTime && ticket.drawTime !== filterTime) passesFilters = false;
            if (filterDate && (ticketDate < selectedDateStart || ticketDate > selectedDateEnd)) passesFilters = false;

            if (passesFilters) {
                ticket.numbers.forEach(num => {
                    if (num.number.length === 2) {
                        if (!numberSales[num.number]) {
                            numberSales[num.number] = 0;
                        }
                        numberSales[num.number] += parseInt(num.pieces, 10);
                    }
                });
            }
        });

        // Calcular premio REVENTADO (cada 5 tiempos paga $90)
        let totalPrizes = 0;
        let winningTimes = 0;
        let paymentBlocks = 0;

        if (numberSales[reventadoPrize]) {
            winningTimes = numberSales[reventadoPrize];
            paymentBlocks = Math.floor(winningTimes / 5);
            totalPrizes = paymentBlocks * 90;
        }

        // Obtener monto del administrador
        const totals = calculateSalesTotals('tiempos');
        const adminAmount = (totals.totalColones * (100 - sellerPercentage)) / 100;
        const netResult = adminAmount - totalPrizes;

        // Mostrar resultados
        const reventadoHTML = generateReventadoHTML(reventadoPrize, winningTimes, paymentBlocks, totalPrizes, adminAmount, netResult);
        document.getElementById('reventadoWinningsResult').innerHTML = reventadoHTML;

        // Guardar datos REVENTADO
        saveReventadoWinnings(reventadoPrize, reventadoHTML);

        showNotification('Ganancias REVENTADO calculadas y guardadas', 'success');
    }

    // Funci칩n para generar HTML de resultados REVENTADO
    function generateReventadoHTML(number, winningTimes, paymentBlocks, totalPrizes, adminAmount, netResult) {
        if (winningTimes === 0) {
            return `
            <div style="text-align: center; color: #28a745; font-weight: bold;">
                춰El n칰mero ${number} no tiene tiempos vendidos! Ganancia total: $${adminAmount.toFixed(2)}
            </div>
        `;
        }

        let html = `
        <div style="background-color: #f8f9fa; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
            <h5 style="margin: 0 0 10px 0; color: #dc3545;">Resultado REVENTADO - N칰mero ${number}</h5>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                <div><strong>Tiempos vendidos:</strong> ${winningTimes}</div>
                <div><strong>Bloques de pago:</strong> ${paymentBlocks} (cada 5 tiempos)</div>
                <div><strong>Tiempos sin pagar:</strong> ${winningTimes % 5}</div>
                <div><strong>Pago por bloque:</strong> $90.00</div>
            </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-weight: bold; margin-bottom: 10px;">
            <div>Total a Pagar: $${totalPrizes.toFixed(2)}</div>
            <div>Monto Admin: $${adminAmount.toFixed(2)}</div>
        </div>
        <div style="text-align: center; font-weight: bold; font-size: 1.1em; padding: 10px; border-radius: 4px; ${netResult >= 0 ? 'background-color: #d4edda; color: #155724;' : 'background-color: #f8d7da; color: #721c24;'}">
            ${netResult >= 0 ? 'GANANCIA' : 'P칄RDIDA'}: $${Math.abs(netResult).toFixed(2)}
        </div>
    `;

        return html;
    }

    // Funci칩n para guardar n칰meros ganadores REVENTADO
    function saveReventadoWinnings(number, winningsData) {
        const key = getWinningNumbersKey() + '_REVENTADO';
        const data = {
            reventadoPrize: number,
            winningsData: winningsData,
            timestamp: new Date().toISOString()
        };

        localStorage.setItem(key, JSON.stringify(data));
    }

    // Funci칩n para cargar n칰meros ganadores REVENTADO
    function loadReventadoWinnings() {
        const key = getWinningNumbersKey() + '_REVENTADO';
        const savedData = localStorage.getItem(key);

        if (savedData) {
            try {
                const data = JSON.parse(savedData);
                document.getElementById('reventadoPrizeInput').value = data.reventadoPrize;
                document.getElementById('reventadoWinningsResult').innerHTML = data.winningsData;
                showNotification('N칰mero ganador REVENTADO cargado autom치ticamente', 'info', 2000);
            } catch (error) {
                console.error('Error al cargar datos REVENTADO:', error);
            }
        }
    }

    // Funci칩n para generar HTML de resultados (separada para reutilizar)
    function generateWinningsHTML(winners, totalPrizes, adminAmount, netResult) {
        if (winners.length === 0) {
            return `
            <div style="text-align: center; color: #28a745; font-weight: bold;">
                춰No hay n칰meros ganadores! Ganancia total: $${adminAmount.toFixed(2)}
            </div>
        `;
        }

        let html = `
        <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px;">
            <thead>
                <tr style="background-color: #f8f9fa;">
                    <th style="border: 1px solid #ddd; padding: 8px;">N칰mero</th>
                    <th style="border: 1px solid #ddd; padding: 8px;">Premio</th>
                    <th style="border: 1px solid #ddd; padding: 8px;">Tiempos</th>
                    <th style="border: 1px solid #ddd; padding: 8px;">Pago</th>
                </tr>
            </thead>
            <tbody>
    `;

        winners.forEach(winner => {
            html += `
            <tr>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${winner.number}</td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${winner.prize}</td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${winner.times}</td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">$${winner.amount.toFixed(2)}</td>
            </tr>
        `;
        });

        html += `
            </tbody>
        </table>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-weight: bold;">
            <div>Total a Pagar: $${totalPrizes.toFixed(2)}</div>
            <div>Monto Admin: $${adminAmount.toFixed(2)}</div>
        </div>
        <div style="text-align: center; font-weight: bold; font-size: 1.1em; margin-top: 10px; padding: 10px; border-radius: 4px; ${netResult >= 0 ? 'background-color: #d4edda; color: #155724;' : 'background-color: #f8d7da; color: #721c24;'}">
            ${netResult >= 0 ? 'GANANCIA' : 'P칄RDIDA'}: $${Math.abs(netResult).toFixed(2)}
        </div>
    `;

        return html;
    }

    // Funci칩n para mostrar resultados de ganancias
    function displayWinningsResults(winners, totalPrizes, adminAmount, netResult) {
        const resultDiv = document.getElementById('winningsResult');

        if (winners.length === 0) {
            resultDiv.innerHTML = `
            <div style="text-align: center; color: #28a745; font-weight: bold;">
                춰No hay n칰meros ganadores! Ganancia total: $${adminAmount.toFixed(2)}
            </div>
        `;
            return;
        }

        let html = `
        <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px;">
            <thead>
                <tr style="background-color: #f8f9fa;">
                    <th style="border: 1px solid #ddd; padding: 8px;">N칰mero</th>
                    <th style="border: 1px solid #ddd; padding: 8px;">Premio</th>
                    <th style="border: 1px solid #ddd; padding: 8px;">Tiempos</th>
                    <th style="border: 1px solid #ddd; padding: 8px;">Pago</th>
                </tr>
            </thead>
            <tbody>
    `;

        winners.forEach(winner => {
            html += `
            <tr>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${winner.number}</td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${winner.prize}</td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${winner.times}</td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">$${winner.amount.toFixed(2)}</td>
            </tr>
        `;
        });

        html += `
            </tbody>
        </table>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-weight: bold;">
            <div>Total a Pagar: $${totalPrizes.toFixed(2)}</div>
            <div>Monto Admin: $${adminAmount.toFixed(2)}</div>
        </div>
        <div style="text-align: center; font-weight: bold; font-size: 1.1em; margin-top: 10px; padding: 10px; border-radius: 4px; ${netResult >= 0 ? 'background-color: #d4edda; color: #155724;' : 'background-color: #f8d7da; color: #721c24;'}">
            ${netResult >= 0 ? 'GANANCIA' : 'P칄RDIDA'}: $${Math.abs(netResult).toFixed(2)}
        </div>
    `;

        resultDiv.innerHTML = html;
    }

    // Funci칩n para crear el contenedor de captura
    function createScreenshotContainer() {
        const container = document.createElement('div');
        container.className = 'screenshot-container';
        container.style.position = 'absolute';
        container.style.left = '-9999px';
        container.style.width = '800px';
        container.style.fontFamily = 'Arial, sans-serif';

        const filterLottery = document.getElementById('filterLotteryType').value || 'Todas';
        const filterTime = document.getElementById('filterDrawTimeSelect').value || 'Todas las Horas';
        const filterDate = document.getElementById('salesFilterDate').value || 'Todas';

        const header = document.createElement('div');
        header.className = 'screenshot-header';
        header.innerHTML = `
        <div class="filters-info-horizontal" style="
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            padding: 8px 0;
        ">
            <div><strong>Loter칤a:</strong> ${filterLottery}</div>
            <div><strong>Hora:</strong> ${filterTime}</div>
            <div><strong>Fecha:</strong> ${filterDate}</div>
            <div><strong>Vendedor:</strong> ${sellerName}</div>
        </div>
        <div style="text-align: center; padding-top: 5px; font-size: 12px;">
            <strong>Generado:</strong> ${new Date().toLocaleString('es-ES', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false
        }).replace(',', ' -')}
        </div>
    `;
        container.appendChild(header);

        // Clonar resumen de ventas
        const summaryBox = document.getElementById('salesSummaryBox');
        if (summaryBox && summaryBox.style.display !== 'none') {
            const summaryClone = summaryBox.cloneNode(true);
            summaryClone.style.margin = '20px';
            container.appendChild(summaryClone);

            addPercentageBreakdown(summaryClone, calculateSalesTotals(activeTab).totalColones);

            // Remover el bot칩n de configuraci칩n del clone
            const configButton = summaryClone.querySelector('.percentage-config-button');
            if (configButton) {
                configButton.remove();
            }
        }

        // Clonar grilla de n칰meros
        let gridToClone;
        if (activeTab === 'tiempos') {
            gridToClone = document.getElementById('numberSalesGrid');
        } else {
            gridToClone = document.getElementById('billetesSalesGrid');
        }

        if (gridToClone) {
            const gridClone = gridToClone.cloneNode(true);
            gridClone.style.margin = '20px';
            gridClone.style.fontSize = '14px';
            container.appendChild(gridClone);
        }

        // NUEVO: Agregar secci칩n de n칰meros ganadores si existe y es pesta침a tiempos
        // NUEVO: Agregar secci칩n de n칰meros ganadores si existe y es pesta침a tiempos
        if (activeTab === 'tiempos') {
            const winningSection = document.getElementById('independentWinningSection');
            if (winningSection && winningSection.style.display !== 'none') {
                const winningClone = winningSection.cloneNode(true);
                winningClone.style.margin = '20px';

                // Remover todos los botones del clone
                const buttons = winningClone.querySelectorAll('button');
                buttons.forEach(button => button.remove());

                // Verificar si es loter칤a REVENTADO
                const filterLottery = document.getElementById('filterLotteryType').value;
                const isReventadoLottery = filterLottery && filterLottery.startsWith('REVENTADO_');

                if (isReventadoLottery) {
                    // Manejo para REVENTADO
                    const reventadoResult = winningClone.querySelector('#reventadoWinningsResult');
                    const reventadoPrize = document.getElementById('reventadoPrizeInput').value;

                    if (reventadoResult && reventadoResult.innerHTML.trim() !== '' && reventadoPrize) {
                        // Reemplazar input con texto para REVENTADO
                        const inputContainer = winningClone.querySelector('div[style*="display: flex"]');
                        if (inputContainer) {
                            inputContainer.innerHTML = `
                        <div style="text-align: center;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #666;">N칰mero Ganador</label>
                            <div style="font-size: 24px; font-weight: bold; color: #dc3545; padding: 10px; border: 2px solid #dc3545; border-radius: 4px; width: 80px; margin: 0 auto;">${reventadoPrize}</div>
                        </div>
                    `;
                        }
                        container.appendChild(winningClone);
                    }
                } else {
                    // Manejo para loter칤as normales
                    const winningsResult = winningClone.querySelector('#winningsResult');
                    if (winningsResult && winningsResult.innerHTML.trim() !== '') {
                        const firstPrize = document.getElementById('firstPrizeInput').value;
                        const secondPrize = document.getElementById('secondPrizeInput').value;
                        const thirdPrize = document.getElementById('thirdPrizeInput').value;

                        if (firstPrize && secondPrize && thirdPrize) {
                            // Reemplazar inputs con texto para loter칤as normales
                            const inputContainer = winningClone.querySelector('div[style*="grid-template-columns: repeat(3, 1fr)"]');
                            if (inputContainer) {
                                inputContainer.innerHTML = `
                            <div style="text-align: center;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #666;">1er Premio</label>
                                <div style="font-size: 18px; font-weight: bold; color: #007bff;">${firstPrize}</div>
                            </div>
                            <div style="text-align: center;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #666;">2do Premio</label>
                                <div style="font-size: 18px; font-weight: bold; color: #28a745;">${secondPrize}</div>
                            </div>
                            <div style="text-align: center;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #666;">3er Premio</label>
                                <div style="font-size: 18px; font-weight: bold; color: #ffc107;">${thirdPrize}</div>
                            </div>
                        `;
                            }
                            container.appendChild(winningClone);
                        }
                    }
                }
            }
        }

        const footer = document.createElement('div');
        footer.style.textAlign = 'center';
        footer.style.padding = '20px';
        footer.style.fontSize = '12px';
        footer.style.color = '#666';
        footer.innerHTML = `
        <div>Sistema de Loter칤a APM11</div>
        <div>Reporte generado autom치ticamente</div>
    `;
        container.appendChild(footer);

        return container;
    }

    // Funci칩n para capturar y compartir la pantalla
    async function captureAndShareScreen() {
        const button = document.getElementById('screenshotButton');

        try {
            button.textContent = '游닞 Capturando...';
            button.classList.add('capturing');
            button.disabled = true;

            const captureContainer = createScreenshotContainer();
            document.body.appendChild(captureContainer);

            const canvas = await html2canvas(captureContainer, {
                scale: 2,
                backgroundColor: '#ffffff',
                logging: false,
                width: 800,
                height: captureContainer.scrollHeight,
                useCORS: true,
                allowTaint: true
            });

            document.body.removeChild(captureContainer);
            const base64 = canvas.toDataURL('image/png', 0.9);

            if (typeof Android !== 'undefined' && Android.shareImageFromAndroid) {
                Android.shareImageFromAndroid(base64, 'Reporte de Tiempos Vendidos');
            } else {
                downloadImage(base64, 'tiempos-vendidos.png');
            }

        } catch (error) {
            console.error('Error al capturar pantalla:', error);
            showNotification('Error al generar la captura de pantalla. Intente nuevamente.');
        } finally {
            button.textContent = 'Compartir por WhatsApp';
            button.classList.remove('capturing');
            button.disabled = false;
        }
    }

    // Funci칩n para descargar imagen (fallback)
    function downloadImage(base64, filename) {
        const link = document.createElement('a');
        link.download = filename;
        link.href = base64;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        showNotification('Imagen descargada. Puede compartirla manualmente por WhatsApp.');
    }

    // Variables para porcentajes y nombre del vendedor
    let sellerPercentage = 13; // Porcentaje por defecto del vendedor
    let sellerName = "XXXXX"; // Nombre por defecto del vendedor

    // Inicializar porcentaje y nombre desde localStorage
    function initSellerPercentage() {
        const savedPercentage = localStorage.getItem('sellerPercentage');
        if (savedPercentage) {
            sellerPercentage = parseFloat(savedPercentage);
        }

        const savedName = localStorage.getItem('sellerName');
        if (savedName) {
            sellerName = savedName;
        }
    }

    // Funci칩n corregida para mostrar el nombre del vendedor
    function addPercentageBreakdown(summaryBox, totalAmount) {
        // Remover breakdown previo si existe
        const existingBreakdown = summaryBox.querySelector('.percentage-breakdown');
        if (existingBreakdown) {
            existingBreakdown.remove();
        }

        // Remover bot칩n previo si existe
        const existingButton = summaryBox.querySelector('.percentage-config-button');
        if (existingButton) {
            existingButton.remove();
        }

        // Calcular y mostrar porcentajes siempre, incluso si totalAmount es 0
        const sellerAmount = (totalAmount * sellerPercentage) / 100;
        const adminAmount = totalAmount - sellerAmount;

        const breakdown = document.createElement('div');
        breakdown.className = 'percentage-breakdown';
        breakdown.innerHTML = `
        <div class="percentage-item seller">
            <div class="percentage-value">$${sellerAmount.toFixed(2)}</div>
            <div class="percentage-label">${sellerName} (${sellerPercentage}%)</div>
        </div>
        <div class="percentage-item admin">
            <div class="percentage-value">$${adminAmount.toFixed(2)}</div>
            <div class="percentage-label">Admin (${(100 - sellerPercentage)}%)</div>
        </div>
    `;

        summaryBox.appendChild(breakdown);

    }

    // Abrir modal de configuraci칩n de porcentaje
    function openPercentageModal() {
        closeMenu();
        const modal = document.getElementById('percentageModal');
        const input = document.getElementById('sellerPercentageInput');
        const nameInput = document.getElementById('sellerNameInput');
        const passwordInput = document.getElementById('passwordForPercentage');
        const errorElement = document.getElementById('percentageError');

        input.value = sellerPercentage;
        nameInput.value = sellerName;
        passwordInput.value = '';
        errorElement.style.display = 'none';
        modal.style.display = 'block';
    }

    // Cerrar modal de configuraci칩n de porcentaje
    function closePercentageModal() {
        const modal = document.getElementById('percentageModal');
        modal.style.display = 'none';
    }

    // Guardar configuraci칩n del vendedor (nombre y porcentaje)
    function saveSellerConfig() {
        const password = document.getElementById('passwordForPercentage').value;
        const newPercentage = parseFloat(document.getElementById('sellerPercentageInput').value);
        const newName = document.getElementById('sellerNameInput').value.trim();
        const errorElement = document.getElementById('percentageError');

        // Verificar contrase침a
        if (password !== PASSWORD) {
            errorElement.textContent = 'Contrase침a incorrecta.';
            errorElement.style.display = 'block';
            return;
        }

        // Validar nombre
        if (!newName) {
            errorElement.textContent = 'Por favor ingrese el nombre del vendedor.';
            errorElement.style.display = 'block';
            return;
        }

        // Validar porcentaje
        if (isNaN(newPercentage) || newPercentage < 0 || newPercentage > 100) {
            errorElement.textContent = 'Ingrese un porcentaje v치lido entre 0 y 100.';
            errorElement.style.display = 'block';
            return;
        }

        // Guardar la nueva configuraci칩n
        sellerPercentage = newPercentage;
        sellerName = newName;
        localStorage.setItem('sellerPercentage', sellerPercentage.toString());
        localStorage.setItem('sellerName', sellerName);

        // Cerrar modal
        closePercentageModal();

        // Actualizar la visualizaci칩n
        if (activeTab === 'tiempos') {
            updateNumberSalesTable();
        } else {
            updateBilletesSalesTable();
        }

        showNotification(`Configuraci칩n actualizada:\nVendedor: ${sellerName}\nPorcentaje: ${sellerPercentage}%`);
    }

    // Sistema de notificaciones personalizado
    function showNotification(message, type = 'info', duration = 4000) {
        // Remover notificaciones existentes
        const existingNotifications = document.querySelectorAll('.custom-notification');
        existingNotifications.forEach(notification => notification.remove());

        // Crear nueva notificaci칩n
        const notification = document.createElement('div');
        notification.className = `custom-notification ${type}`;
        notification.innerHTML = `
        <span>${message}</span>
        <button class="notification-close" onclick="closeNotification(this)">&times;</button>
    `;

        document.body.appendChild(notification);

        // Mostrar con animaci칩n
        setTimeout(() => notification.classList.add('show'), 100);

        // Ocultar autom치ticamente
        setTimeout(() => {
            hideNotification(notification);
        }, duration);
    }

    function hideNotification(notification) {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notification && notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 400);
    }

    function closeNotification(closeBtn) {
        const notification = closeBtn.closest('.custom-notification');
        hideNotification(notification);
    }

    // Modal de confirmaci칩n personalizado
    function showConfirm(message, title = 'Confirmar acci칩n', onConfirm = null, onCancel = null) {
        const modal = document.getElementById('customConfirmModal');
        const titleElement = document.getElementById('confirmTitle');
        const messageElement = document.getElementById('confirmMessage');
        const confirmBtn = document.getElementById('confirmBtn');
        const cancelBtn = document.getElementById('cancelBtn');

        titleElement.textContent = title;
        messageElement.textContent = message;

        // Limpiar eventos anteriores
        const newConfirmBtn = confirmBtn.cloneNode(true);
        const newCancelBtn = cancelBtn.cloneNode(true);
        confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
        cancelBtn.parentNode.replaceChild(newCancelBtn, cancelBtn);

        // Agregar nuevos eventos
        newConfirmBtn.onclick = () => {
            modal.style.display = 'none';
            if (onConfirm) onConfirm();
        };

        newCancelBtn.onclick = () => {
            modal.style.display = 'none';
            if (onCancel) onCancel();
        };

        // Cerrar al hacer clic fuera del modal
        modal.onclick = (e) => {
            if (e.target === modal) {
                modal.style.display = 'none';
                if (onCancel) onCancel();
            }
        };

        modal.style.display = 'block';
    }

    // Funci칩n auxiliar para promesas con confirm
    function confirmAsync(message, title = 'Confirmar acci칩n') {
        return new Promise((resolve) => {
            showConfirm(message, title,
                () => resolve(true),
                () => resolve(false)
            );
        });
    }

    // Variables para el teclado num칠rico
    let currentActiveInput = null;
    let keyboardVisible = false;

    // Mostrar teclado num칠rico
    function showKeyboard(inputElement) {
        currentActiveInput = inputElement;
        const keyboard = document.getElementById('customKeyboard');
        const keyboardTitle = document.querySelector('.keyboard-title');

        // Cambiar t칤tulo seg칰n el campo activo
        if (inputElement.id === 'number') {
            keyboardTitle.textContent = 'Ingresa el n칰mero';
        } else if (inputElement.id === 'pieces') {
            keyboardTitle.textContent = 'Ingresa los tiempos';
        }

        // Remover clase activa de otros inputs
        document.querySelectorAll('.input-group input').forEach(input => {
            input.classList.remove('keyboard-active');
        });

        // Agregar clase activa al input actual
        inputElement.classList.add('keyboard-active');

        keyboard.classList.add('show');
        document.body.classList.add('keyboard-open');
        keyboardVisible = true;

        // Prevenir que aparezca el teclado del sistema en m칩viles
        inputElement.setAttribute('readonly', 'readonly');
    }

    // Ocultar teclado num칠rico
    function hideKeyboard() {
        const keyboard = document.getElementById('customKeyboard');
        keyboard.classList.remove('show');
        document.body.classList.remove('keyboard-open');
        keyboardVisible = false;

        // Remover clase activa de todos los inputs
        document.querySelectorAll('.input-group input').forEach(input => {
            input.classList.remove('keyboard-active');
            input.removeAttribute('readonly');
        });

        currentActiveInput = null;
    }

    // Agregar d칤gito
    function addDigit(digit) {
        if (!currentActiveInput) return;

        const currentValue = currentActiveInput.value;
        const maxLength = currentActiveInput.id === 'number' ? 4 : 10; // 4 d칤gitos para n칰mero, 10 para tiempos

        if (currentValue.length < maxLength) {
            currentActiveInput.value = currentValue + digit;
        }
    }

    // Eliminar 칰ltimo d칤gito
    function deleteDigit() {
        if (!currentActiveInput) return;

        const currentValue = currentActiveInput.value;
        currentActiveInput.value = currentValue.slice(0, -1);
    }

    function submitNumber() {
        if (!currentActiveInput) return;

        const numberInput = document.getElementById('number');
        const piecesInput = document.getElementById('pieces');

        if (currentActiveInput === numberInput) {
            // Si estamos en el campo n칰mero, ir al campo tiempos
            if (numberInput.value.trim()) {
                showKeyboard(piecesInput);
                piecesInput.focus();
            } else {
                showNotification('Por favor ingrese un n칰mero', 'warning');
            }
        } else if (currentActiveInput === piecesInput) {
            // Si estamos en el campo tiempos y ambos campos est치n llenos, agregar n칰mero
            if (numberInput.value.trim() && piecesInput.value.trim()) {
                // L칩gica de addNumber() integrada aqu칤
                const number = numberInput.value;
                const pieces = parseInt(piecesInput.value, 10);
                const lotteryType = document.getElementById('lotteryType').value;

                if (!validateNumber(number)) {
                    showNotification('El n칰mero debe tener 2 o 4 cifras', 'warning');
                    return;
                }

                if (!lotteryType) {
                    showNotification('Por favor seleccione una loter칤a', 'warning');
                    return;
                }

                if (lotteryType !== 'PANAMA' && lotteryType !== 'REVENTADO_PANAMA') {
                    const drawTime = document.getElementById('drawTimeSelect').value;
                    if (!drawTime) {
                        showNotification('Por favor seleccione hora de sorteo', 'warning');
                        return;
                    }
                }

                // Validar horario antes de verificar l칤mites
                if (!validarHorarioVenta()) {
                    showNotification('No se pueden vender n칰meros. Ventas bloqueadas 1 minutos antes y 20 minutos despu칠s del sorteo.', 'warning');
                    return; // ESTE RETURN FALTABA
                }

                if (!checkLimits(number, pieces)) {
                    return;
                }

                const subTotal = calculatePrice(number, pieces, lotteryType);
                numbers.push({ number, pieces, subTotal, lotteryType });

                updateNumbersList();
                updateTotal();
                updateCurrentSales(number, pieces, true);

                // Limpiar campos y volver al campo n칰mero
                numberInput.value = '';
                piecesInput.value = '';
                showKeyboard(numberInput);
                numberInput.focus();
            } else if (!piecesInput.value.trim()) {
                showNotification('Por favor ingrese la cantidad de tiempos', 'warning');
            } else {
                showNotification('Por favor complete el n칰mero', 'warning');
            }
        }
    }

    // Inicializar eventos del teclado num칠rico
    function initKeyboardEvents() {
        const numberInput = document.getElementById('number');
        const piecesInput = document.getElementById('pieces');

        // Evento focus para mostrar teclado
        numberInput.addEventListener('focus', function () {
            showKeyboard(this);
        });

        piecesInput.addEventListener('focus', function () {
            showKeyboard(this);
        });

        // Prevenir teclado del sistema en m칩viles
        numberInput.addEventListener('click', function () {
            showKeyboard(this);
        });

        piecesInput.addEventListener('click', function () {
            showKeyboard(this);
        });

        // Ocultar teclado al hacer clic fuera
        document.addEventListener('click', function (e) {
            const keyboard = document.getElementById('customKeyboard');
            const numberInput = document.getElementById('number');
            const piecesInput = document.getElementById('pieces');

            if (keyboardVisible &&
                !keyboard.contains(e.target) &&
                e.target !== numberInput &&
                e.target !== piecesInput) {
                hideKeyboard();
            }
        });

        // Prevenir teclado f칤sico en estos campos
        [numberInput, piecesInput].forEach(input => {
            input.addEventListener('keydown', function (e) {
                if (keyboardVisible) {
                    e.preventDefault();

                    // Permitir solo n칰meros del teclado f칤sico como alternativa
                    if (e.key >= '0' && e.key <= '9') {
                        addDigit(e.key);
                    } else if (e.key === 'Backspace') {
                        deleteDigit();
                    } else if (e.key === 'Enter') {
                        submitNumber();
                    } else if (e.key === 'Escape') {
                        hideKeyboard();
                    }
                }
            });
        });
    }

    // Funci칩n para limpiar inputs de premios normales
    function clearPrizeInputs() {
        document.getElementById('firstPrizeInput').value = '';
        document.getElementById('secondPrizeInput').value = '';
        document.getElementById('thirdPrizeInput').value = '';
        document.getElementById('winningsResult').innerHTML = '';

        // Limpiar de localStorage
        const filterLottery = document.getElementById('filterLotteryType').value;
        const filterTime = document.getElementById('filterDrawTimeSelect').value;
        const filterDate = document.getElementById('salesFilterDate').value;
        const key = `winningNumbers_${filterLottery}_${filterTime}_${filterDate}`;
        localStorage.removeItem(key);

        showNotification('Premios limpiados', 'success');
    }

    // Funci칩n para limpiar input de REVENTADO
    function clearReventadoPrizeInput() {
        document.getElementById('reventadoPrizeInput').value = '';
        document.getElementById('reventadoWinningsResult').innerHTML = '';

        // Limpiar de localStorage
        const filterLottery = document.getElementById('filterLotteryType').value;
        const filterTime = document.getElementById('filterDrawTimeSelect').value;
        const filterDate = document.getElementById('salesFilterDate').value;
        const key = `reventadoWinningNumber_${filterLottery}_${filterTime}_${filterDate}`;
        localStorage.removeItem(key);

        showNotification('Premio limpiado', 'success');
    }

    function borrarTodasVentas() {
    // Mostrar un modal de confirmaci칩n con una advertencia fuerte
    showConfirm(
        "丘멆잺 ADVERTENCIA: Esta acci칩n eliminar치 TODAS las ventas guardadas. Esta operaci칩n NO SE PUEDE deshacer. 쮼st치 absolutamente seguro de que desea borrar TODOS los tickets?",
        'Borrar TODAS las Ventas',
        () => {
            // Eliminar todos los tickets de localStorage
            localStorage.removeItem('lotteryTickets');

            // Reiniciar c치lculos de ventas actuales
            currentSales = {
                chances: {},
                billetes: {}
            };

            // Limpiar la lista de tickets y el resumen de ventas
            displayTickets();

            // Reiniciar resumen de ventas
            document.getElementById('totalTickets').textContent = '0';
            document.getElementById('totalSales').textContent = '0.00';

            // Mostrar notificaci칩n de 칠xito
            showNotification('Todas las ventas han sido eliminadas permanentemente.', 'success', 5000);
        }
    );
}

    // Variables para el men칰
    let menuOpen = false;

    // Funci칩n para alternar el men칰
    function toggleMenu() {
        if (menuOpen) {
            closeMenu();
        } else {
            openMenu();
        }
    }

    // Funci칩n para abrir el men칰
    function openMenu() {
        const dropdown = document.getElementById('menuDropdown');
        const overlay = document.getElementById('menuOverlay');
        const icon = document.getElementById('hamburgerIcon');

        dropdown.classList.add('show');
        overlay.classList.add('show');
        icon.classList.add('open');
        menuOpen = true;
    }

    // Funci칩n para cerrar el men칰
    function closeMenu() {
        const dropdown = document.getElementById('menuDropdown');
        const overlay = document.getElementById('menuOverlay');
        const icon = document.getElementById('hamburgerIcon');

        dropdown.classList.remove('show');
        overlay.classList.remove('show');
        icon.classList.remove('open');
        menuOpen = false;
    }

    // Cerrar men칰 con tecla Escape
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && menuOpen) {
            closeMenu();
        }
    });

    // Funciones para el modal de seguidillas
    function openSeguidillaModal() {
        // Verificar que haya loter츾춼a seleccionada
        const lotteryType = document.getElementById('lotteryType').value;
        if (!lotteryType) {
            showNotification('Por favor seleccione una loteria primero', 'warning');
            return;
        }

        // Verificar hora de sorteo para loter츾춼as que no sean PANAMA
        if (lotteryType !== 'PANAMA' && lotteryType !== 'REVENTADO_PANAMA') {
            const drawTime = document.getElementById('drawTimeSelect').value;
            if (!drawTime) {
                showNotification('Por favor seleccione hora de sorteo primero', 'warning');
                return;
            }
        }

        const modal = document.getElementById('seguidillaModal');
        modal.style.display = 'block';

        // Limpiar campos
        document.getElementById('seguidillaDesde').value = '';
        document.getElementById('seguidillaHasta').value = '';
        document.getElementById('seguidillaTiempos').value = '';
    }

    function closeSeguidillaModal() {
        const modal = document.getElementById('seguidillaModal');
        modal.style.display = 'none';
    }

    function addSeguidilla() {
        const desde = parseInt(document.getElementById('seguidillaDesde').value);
        const hasta = parseInt(document.getElementById('seguidillaHasta').value);
        const tiempos = parseInt(document.getElementById('seguidillaTiempos').value);
        const lotteryType = document.getElementById('lotteryType').value;

        // Validaciones
        if (isNaN(desde) || isNaN(hasta) || isNaN(tiempos)) {
            showNotification('Por favor complete todos los campos', 'warning');
            return;
        }

        if (desde < 0 || desde > 99 || hasta < 0 || hasta > 99) {
            showNotification('Los numeros deben estar entre 00 y 99', 'warning');
            return;
        }

        if (desde > hasta) {
            showNotification('El numero "Desde" debe ser menor o igual al "Hasta"', 'warning');
            return;
        }

        if (tiempos <= 0) {
            showNotification('Los tiempos deben ser mayor que 0', 'warning');
            return;
        }

        // Validar horario antes de procesar
        if (!validarHorarioVenta()) {
            showNotification('No se pueden agregar numeros. Ventas bloqueadas 1 minuto antes y 20 minutos despues del sorteo.', 'warning');
            return;
        }

        let processed = 0;
        let blocked = 0;

        // Procesar la seguidilla
        for (let i = desde; i <= hasta; i++) {
            const number = i.toString().padStart(2, '0');

            // Verificar l츾춼mites
            if (checkLimits(number, tiempos)) {
                const subTotal = calculatePrice(number, tiempos, lotteryType);
                numbers.push({ number, pieces: tiempos, subTotal });
                updateCurrentSales(number, tiempos, true);
                processed++;
            } else {
                blocked++;
            }
        }

        // Actualizar la interfaz
        if (processed > 0) {
            updateNumbersList();
            updateTotal();

            let message = `Seguidilla agregada: ${processed} numeros procesados`;
            if (blocked > 0) {
                message += ` (${blocked} bloqueados por li춼mites)`;
            }

            showNotification(message, 'success');
            closeSeguidillaModal();
        } else {
            showNotification('No se pudieron agregar numeros debido a los li춼mites establecidos', 'warning');
        }
    }

    // Cerrar modal al hacer clic fuera
    window.addEventListener('click', function (event) {
        const modal = document.getElementById('seguidillaModal');
        if (event.target === modal) {
            closeSeguidillaModal();
        }
    });

    // Cerrar modal al hacer clic fuera de 칠l
    window.onclick = function (event) {
        const modal = document.getElementById('percentageModal');
        if (event.target === modal) {
            closePercentageModal();
        }
    }


    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('data:application/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4ge30pO3NlbGYuYWRkRXZlbnRMaXN0ZW5lcignZmV0Y2gnLCBldmVudCA9PiB7fSk7')
            .then(() => console.log('Service Worker Registered'))
            .catch(error => console.log('Service Worker Registration Failed:', error));
    }

    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
    });
</script>
</body>

</html>


